<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ â€” Ù„Ø¹Ø¨Ø© 30 Ø³Ø¤Ø§Ù„</title>
  <style>
    :root{
      --bg:#f8f6fb; --ink:#111827; --muted:#6b7280; --border:#e5e7eb;
      --panel:#fff; --panel2:#faf5ff; --accent:#7c3aed; --ok:#16a34a; --bad:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:"Tahoma",Arial,sans-serif}
    .wrap{max-width:980px;margin:auto;padding:18px}
    h1{margin:6px 0 4px;text-align:center}
    .sub{color:var(--muted);text-align:center;margin-bottom:10px}
    .status{display:flex;justify-content:space-between;align-items:center;gap:8px;background:var(--panel2);border:1px solid var(--border);padding:10px 12px;border-radius:12px}
    .chip{font-weight:700;padding:8px 12px;border-radius:10px;background:#e0e7ff}
    .chip.time{background:#ffe4e6}
    .card{margin-top:14px;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 8px 20px rgba(0,0,0,.05)}
    .qbar{background:#ede9fe;border:1px solid #c4b5fd;padding:14px;border-radius:10px;text-align:center;font-weight:800}
    .answers{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:14px}
    .answers button{background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px 18px;cursor:pointer;min-width:140px;font-weight:700}
    .answers button:hover{filter:brightness(.98)}
    table{border-collapse:collapse;margin:8px auto}
    th,td{border:1px solid #d1d5db;padding:6px 10px}
    .tiny{color:var(--muted);font-size:13px;text-align:center;margin-top:6px}
    footer{margin:18px 0;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ</h1>
    <p class="sub">Ø£Ø¬Ø¨ Ø¹Ù† <b>30</b> Ø³Ø¤Ø§Ù„Ù‹Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯. Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª Ø³ØªØ¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>

    <div class="status">
      <div class="chip">Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="qNo">1 / 30</span></div>
      <div class="chip">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span> / 30</div>
      <div class="chip time">â° Ø§Ù„ÙˆÙ‚Øª: <span id="time">180</span> Ø«Ø§Ù†ÙŠØ©</div>
    </div>

    <section class="card">
      <div id="qbar" class="qbar">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</div>
      <div id="extra"></div>
      <div id="answers" class="answers"></div>
      <p class="tiny">ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ù…ØªÙˆØ³Ø· = Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù‚ÙŠÙ… Ã· Ø¹Ø¯Ø¯Ù‡Ø§</p>
    </section>

    <footer>Ø¥Ø¹Ø¯Ø§Ø¯: Ø£.Ø¨ÙŠØ§Ù† Ø¬Ø¹ÙØ± Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø²Ø§Ù‚ Ø¹Ø¨Ø§Ø³</footer>
  </div>

<script>
/* ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ========== */
const TOTAL_QUESTIONS = 30;
const TIME_LIMIT = 180; // Ø¹Ø¯Ù‘Ù„ÙŠÙ‡Ø§ Ø¥Ù† Ø­Ø¨ÙŠØªÙŠ (Ù…Ø«Ù„Ø§Ù‹ 1280)
const ROUND_TO = 1;     // Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ù„Ø¹Ø¯Ø¯ Ø¹Ø´Ø±ÙŠ ÙˆØ§Ø­Ø¯

/* ========== Ø¹Ù†Ø§ØµØ± DOM ========== */
const qNoEl = document.getElementById('qNo');
const scoreEl = document.getElementById('score');
const timeEl = document.getElementById('time');
const qbar = document.getElementById('qbar');
const answersBox = document.getElementById('answers');
const extraBox = document.getElementById('extra');

/* ========== Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ========== */
const rand = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
const shuffle = arr => arr.sort(()=>Math.random()-0.5);
const sum = arr => arr.reduce((x,y)=>x+y,0);
const mean = arr => sum(arr)/arr.length;
const round1 = x => Number((Math.round(x*10)/10).toFixed(ROUND_TO));
function makeChoices(correct, poolSteps=[1,2,3]){
  const s = new Set([correct]);
  const c = Number(correct);
  poolSteps.forEach(d=>{
    s.add(round1(c+d));
    s.add(round1(c-d));
  });
  const opts = Array.from(s).slice(0,3);
  return shuffle(opts.map(String));
}
function makeIntChoices(correct, offsets=[1,2,3]){
  const s = new Set([correct]);
  offsets.forEach(d=>{ s.add(correct+d); s.add(correct-d); });
  const opts = Array.from(s).filter(x=>x>0).slice(0,3);
  return shuffle(opts.map(String));
}
function renderTable(headers, rows){
  let html = '<table><thead><tr>';
  headers.forEach(h=> html += `<th>${h}</th>`);
  html += '</tr></thead><tbody>';
  rows.forEach(r=>{
    html += '<tr>'+r.map(c=>`<td>${c}</td>`).join('')+'</tr>';
  });
  html += '</tbody></table>';
  return html;
}

/* ========== Ù…ÙˆÙ„Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ========== */
/* Ø§Ù„Ù†ÙˆØ¹ A: Ù…ØªÙˆØ³Ø· Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø¹Ø¯Ø§Ø¯ Ø¨Ø³ÙŠØ·Ø© (4â€“6 Ø£Ø¹Ø¯Ø§Ø¯) */
function qMeanBasic(){
  const n = rand(4,6);
  const arr = Array.from({length:n},()=>rand(5,30));
  const m = round1(mean(arr));
  const text = `Ø£ÙˆØ¬Ø¯ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©: [ ${arr.join(' ØŒ ')} ]`;
  const options = makeChoices(m);
  return {text, options, correct:String(m)};
}

/* Ø§Ù„Ù†ÙˆØ¹ B: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ·Ø±ÙØ© */
function qOutlier(){
  const base = rand(8,18);
  const arr = [base-1, base, base+1, base+2];
  const out = rand(30,45);
  arr.push(out);
  shuffle(arr);
  const text = `Ø£ÙŠÙ‘Ù Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙØ¹Ø¯Ù‘Ù Ù‚ÙŠÙ…Ø©Ù‹ Ù…ÙØªØ·Ø±Ù‘ÙÙØ© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©: [ ${arr.join(' ØŒ ')} ] ØŸ`;
  const options = shuffle(arr.slice(0,3).map(String)); // Ø«Ù„Ø§Ø«Ø© Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… (ØªØ¶Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ØªØ·Ø±ÙØ© ØºØ§Ù„Ø¨Ù‹Ø§)
  if(!options.includes(String(out))){
    options[rand(0,options.length-1)] = String(out);
  }
  return {text, options, correct:String(out)};
}

/* Ø§Ù„Ù†ÙˆØ¹ C: Ù…ØªÙˆØ³Ø· Ø¨Ø¹Ø¯ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ØªØ·Ø±ÙØ© */
function qMeanWithoutOutlier(){
  const base = rand(8,18);
  const arr = [base-1, base, base, base+1];
  const out = rand(35,45);
  arr.push(out);
  const m = round1(mean(arr.filter(x=>x!==out)));
  const text = `Ø£ÙØ²ÙŠØ­Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ·Ø±Ù‘ÙØ© Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© [ ${arr.join(' ØŒ ')} ]. Ù…Ø§ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŸ`;
  const options = makeChoices(m);
  return {text, options, correct:String(m)};
}

/* Ø§Ù„Ù†ÙˆØ¹ D: Ù…Ø³Ø£Ù„Ø© Ø£Ø¹Ù…Ø§Ø± (Ù†ØµÙŠØ©) */
function qAges(){
  const ages = Array.from({length:5},()=>rand(7,15));
  const m = round1(mean(ages));
  const text = `Ø£Ø¹Ù…Ø§Ø± Ø®Ù…Ø³Ø© Ø·Ù„Ø§Ø¨ Ù‡ÙŠ: ${ages.join('ØŒ ')} Ø³Ù†Ø©. Ù…Ø§ Ù…ØªÙˆØ³Ø· Ø£Ø¹Ù…Ø§Ø±Ù‡Ù…ØŸ`;
  const options = makeChoices(m);
  return {text, options, correct:String(m)};
}

/* Ø§Ù„Ù†ÙˆØ¹ E: Ù…ØªÙˆØ³Ø· Ù…Ù† Ø¬Ø¯ÙˆÙ„ ØªÙƒØ±Ø§Ø±ÙŠ (Ù…ÙˆØ²ÙˆÙ†) */
function qFrequency(){
  // Ù†ÙˆÙ„Ù‘Ø¯ 3â€“4 Ù‚ÙŠÙ… Ù…Ø¹ ØªÙƒØ±Ø§Ø±Ø§Øª
  const k = rand(3,4);
  const values = Array.from({length:k},()=>rand(5,12));
  const freqs  = Array.from({length:k},()=>rand(1,4));
  const rows = values.map((v,i)=>[v, freqs[i]]);
  const weighted = round1( sum(values.map((v,i)=> v*freqs[i])) / sum(freqs) );
  const text = `Ø£ÙˆØ¬Ø¯ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±ÙŠ Ø§Ù„Ø¢ØªÙŠ (Ø§Ù„Ù‚ÙŠÙ…Ø© Ã— Ø§Ù„ØªÙƒØ±Ø§Ø±):`;
  const tableHTML = renderTable(['Ø§Ù„Ù‚ÙŠÙ…Ø©','Ø§Ù„ØªÙƒØ±Ø§Ø±'], rows);
  const options = makeChoices(weighted,[0.5,1,1.5,2]);
  return {text, options, correct:String(weighted), extra:tableHTML};
}

/* Ø§Ù„Ù†ÙˆØ¹ F: Ø£ÙƒÙ…Ù„ Ù‚ÙŠÙ…Ø© Ù†Ø§Ù‚ØµØ© Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ù‘Ø· */
function qMissingFromMean(){
  const a = rand(6,12), b = rand(8,14), c = rand(9,15), d = rand(10,16);
  const targetMean = rand(10,14);
  // (a+b+c+x)/4 = targetMean => x = 4*targetMean - (a+b+c)
  const x = 4*targetMean - (a+b+c);
  // Ø¶Ù…Ù† Ø­Ø¯ Ù…Ø¹Ù‚ÙˆÙ„:
  const text = `Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ (${a} ØŒ ${b} ØŒ ${c} ØŒ Ø³) ÙŠØ³Ø§ÙˆÙŠ ${targetMean}ØŒ ÙÙ…Ø§ Ù‚ÙŠÙ…Ø© Ø³ØŸ`;
  const options = makeIntChoices(x,[1,2,3,4]);
  return {text, options, correct:String(x)};
}

/* Ø§Ù„Ù†ÙˆØ¹ G: Ù‚Ø±Ù‘Ø¨ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ù‘Ø· Ù„Ø£Ù‚Ø±Ø¨ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ */
function qRoundMean(){
  const n = 6;
  const arr = Array.from({length:n},()=>rand(10,35));
  const m = Math.round(mean(arr));
  const text = `Ù‚Ø±Ù‘Ø¨ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© [ ${arr.join(' ØŒ ')} ] Ù„Ø£Ù‚Ø±Ø¨ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­.`;
  const options = makeIntChoices(m,[1,2,3]);
  return {text, options, correct:String(m)};
}

/* ========== Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© 30 Ø³Ø¤Ø§Ù„ (Ø³Ù‡Ù„ â†’ Ø£ØµØ¹Ø¨) ========== */
const BANK = [];
// ØªÙ…Ù‡ÙŠØ¯ÙŠ Ø³Ù‡Ù„
for(let i=0;i<6;i++) BANK.push(qMeanBasic());
// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªØ·Ø±ÙØ© ÙˆÙ…ØªÙˆØ³Ø· Ø¨Ø¯ÙˆÙ†Ù‡Ø§
for(let i=0;i<5;i++) BANK.push(qOutlier());
for(let i=0;i<5;i++) BANK.push(qMeanWithoutOutlier());
// Ù†ØµÙŠØ© Ø£Ø¹Ù…Ø§Ø±
for(let i=0;i<4;i++) BANK.push(qAges());
// Ø¬Ø¯Ø§ÙˆÙ„ ØªÙƒØ±Ø§Ø±ÙŠØ© (Ø£ØµØ¹Ø¨ Ù‚Ù„ÙŠÙ„Ø§Ù‹)
for(let i=0;i<5;i++) BANK.push(qFrequency());
// Ù‚ÙŠÙ…Ø© Ù…ÙÙ‚ÙˆØ¯Ø© Ù…Ù† Ù…ØªÙˆØ³Ø·
for(let i=0;i<3;i++) BANK.push(qMissingFromMean());
// ØªÙ‚Ø±ÙŠØ¨ Ù…ØªÙˆØ³Ø·
for(let i=0;i<2;i++) BANK.push(qRoundMean());

// Ù„Ùˆ Ø²Ø§Ø¯/Ù†Ù‚Øµ Ù†Ø¶Ø¨Ø· Ù„Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
while(BANK.length>TOTAL_QUESTIONS) BANK.pop();
while(BANK.length<TOTAL_QUESTIONS) BANK.push(qMeanBasic());

/* ========== Ù…Ø­Ø±Ùƒ Ø§Ù„Ù„Ø¹Ø¨Ø© ========== */
let idx = 0, score = 0, timeLeft = TIME_LIMIT, timer = null;

function startTimer(){
  clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--; timeEl.textContent = timeLeft;
    if(timeLeft<=0){ fail('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!'); }
  },1000);
}

function render(){
  if(idx>=BANK.length){
    clearInterval(timer);
    alert('Ø£Ø­Ø³Ù†Øª! Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ğŸ‘');
    window.location.href = 'index.html';
    return;
  }
  const visible = `${idx+1} / ${BANK.length}`;
  qNoEl.textContent = visible;

  const q = BANK[idx];
  qbar.textContent = q.text;
  extraBox.innerHTML = q.extra || '';
  answersBox.innerHTML = '';
  q.options.forEach(opt=>{
    const b = document.createElement('button');
    b.textContent = opt;
    b.onclick = ()=> choose(opt, q.correct);
    answersBox.appendChild(b);
  });
}

function choose(sel, correct){
  if(String(sel) === String(correct)){
    score++; scoreEl.textContent = score;
    idx++; render();
  }else{
    fail('Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
  }
}

function fail(msg){
  clearInterval(timer);
  alert(msg + ' Ø³Ù†Ø¹ÙˆØ¯ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.');
  window.location.href = 'index.html';
}

/* ØªØ´ØºÙŠÙ„ */
timeEl.textContent = TIME_LIMIT;
startTimer();
render();
</script>
</body>
</html>
