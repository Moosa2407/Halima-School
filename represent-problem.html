<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø®Ø·Ø© Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© â€” 30 Ø³Ø¤Ø§Ù„ / 180 Ø«Ø§Ù†ÙŠØ©</title>
  <style>
    :root{
      --bg:#f8f6fb; --ink:#111827; --muted:#6b7280; --border:#e5e7eb;
      --panel:#fff; --panel2:#faf5ff; --accent:#7c3aed; --ok:#16a34a; --bad:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:"Segoe UI",Tahoma,Arial,sans-serif}
    .wrap{max-width:1100px;margin:auto;padding:20px}
    header{text-align:center}
    h1{margin:8px 0 4px}
    .subtitle{color:var(--muted)}
    .status{display:flex;justify-content:space-between;gap:10px;background:var(--panel2);
            border:1px solid var(--border);padding:10px;border-radius:12px;margin-top:12px}
    .chip{font-weight:700;padding:8px 12px;border-radius:10px;background:#e0e7ff}
    .chip.time{background:#ffe4e6}
    .card{margin-top:16px;background:var(--panel);border:1px solid var(--border);
          border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    .qbar{background:#ede9fe;border:1px solid #ddd6fe;border-radius:10px;padding:14px;margin-bottom:12px}
    .qbar h2{margin:0;text-align:center;font-size:clamp(18px,3.6vw,26px)}
    .table{width:100%;border-collapse:collapse;margin:8px 0;border-radius:10px;overflow:hidden}
    .table th,.table td{border:1px solid var(--border);padding:8px 10px;text-align:center}
    .table thead{background:#f3f4f6}
    .note{color:var(--muted);text-align:center;margin-top:6px}
    .choices{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    button.choice{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px 16px;cursor:pointer;min-width:160px;font-weight:700}
    button.choice:hover{filter:brightness(.98)}
    .choice.correct{background:#ecfdf5;border-color:#bbf7d0}
    .choice.wrong{background:#fef2f2;border-color:#fecaca}
    .actions{display:flex;justify-content:center;margin-top:10px}
    .btn{border:1px solid var(--border);background:#eef2ff;border-radius:10px;padding:10px 16px;cursor:pointer}
    footer{margin-top:18px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Ø®Ø·Ø© Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©</h1>
      <p class="subtitle">Ù†ØªØ¹Ù„Ù‘Ù… ØªØ­ÙˆÙŠÙ„ Ù†Øµ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø¥Ù„Ù‰ ØªÙ…Ø«ÙŠÙ„ Ù…Ù†Ø§Ø³Ø¨ (Ø¬Ø¯Ø§ÙˆÙ„/Ø±Ø³ÙˆÙ…Ø§Øª/Ù…Ø®Ø·Ø·Ø§Øª) Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ­Ù„Ù‘Ù‡Ø§ Ø¨Ø¯Ù‚Ø©. Ù„Ø¯ÙŠÙƒ 180 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ 30 Ø³Ø¤Ø§Ù„Ù‹Ø§. Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª ÙØ³ØªØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>
    </header>

    <div class="status">
      <div class="chip">Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="counter">0 / 30</span></div>
      <div class="chip">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
      <div class="chip time">â° Ø§Ù„ÙˆÙ‚Øª: <span id="time">180</span> Ø«Ø§Ù†ÙŠØ©</div>
    </div>

    <section class="card">
      <div class="qbar"><h2 id="question">Ø§Ø¶ØºØ·/ÙŠ Ø§Ø¨Ø¯Ø£ Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!</h2></div>

      <div id="workArea"></div>
      <p class="note" id="hint"></p>

      <div class="choices" id="choices"></div>
      <div class="actions"><button class="btn" id="startBtn">Ø§Ø¨Ø¯Ø£ â–¶ï¸</button></div>
    </section>

    <footer id="done" hidden>Ø£Ø­Ø³Ù†Øª! Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø© ğŸ‰</footer>
  </div>

<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© */
const TIME_LIMIT = 180;
const TOTAL_Q    = 30;

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
const counterEl = document.getElementById('counter');
const scoreEl   = document.getElementById('score');
const timeEl    = document.getElementById('time');
const qEl       = document.getElementById('question');
const workEl    = document.getElementById('workArea');
const hintEl    = document.getElementById('hint');
const choicesEl = document.getElementById('choices');
const startBtn  = document.getElementById('startBtn');
const doneEl    = document.getElementById('done');

/* Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© */
const rnd = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
const shuffle = a => a.sort(()=>Math.random()-0.5);

/* Ù…ÙˆÙ„Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© â€” Ø³Ù‡Ù„ */
function g_bestChart_count(){
  const set = [['Ø£Ø­Ø°ÙŠØ©', 'Ø±ÙŠØ§Ø¶Ø©','Ø±Ø³Ù…','Ø¹Ù„ÙˆÙ…','Ù…Ø³Ø±Ø­'], ['ØªÙØ§Ø­','Ø¨Ø±ØªÙ‚Ø§Ù„','Ù…ÙˆØ²','Ø¹Ù†Ø¨']];
  const pick = set[rnd(0,set.length-1)];
  return {
    text:`ØªØ±ÙŠØ¯/ÙŠÙ† Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ù†ÙØµÙ„Ø© (${pick.join('ØŒ ')}) â€” Ù…Ø§ Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø£Ù†Ø³Ø¨ØŸ`,
    table:'', hint:'Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† ÙØ¦Ø§Øª Ù…Ù†ÙØµÙ„Ø© â†’ Ø£Ø¹Ù…Ø¯Ø©/Ø´Ø±ÙŠØ·ÙŠØ©',
    options:['Ù…Ø®Ø·Ø· Ø£Ø¹Ù…Ø¯Ø©','Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ','Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ','Ù…Ø®Ø·Ø· Ù…Ø¨Ø¹Ø«Ø±'],
    answer:'Ù…Ø®Ø·Ø· Ø£Ø¹Ù…Ø¯Ø©'
  };
}
function g_bestChart_time(){
  const thing = ['Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©','Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø© ÙƒÙ„ Ø³Ø§Ø¹Ø©','Ø³Ø¹Ø± Ø³Ù„Ø¹Ø© ÙƒÙ„ ÙŠÙˆÙ…'][rnd(0,2)];
  return {
    text:`ØªØªØ¨Ù‘Ø¹ ${thing} Ø®Ù„Ø§Ù„ Ø§Ù„Ø²Ù…Ù†. Ø£ÙŠ ØªÙ…Ø«ÙŠÙ„ Ø£Ù†Ø³Ø¨ØŸ`,
    table:'', hint:'Ø§Ù„ØªØºÙŠÙ‘Ø± Ù…Ø¹ Ø§Ù„Ø²Ù…Ù† â†’ Ø®Ø·ÙŠ',
    options:['Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ','Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ','Ù…Ø®Ø·Ø· ØµÙˆØ±','Ù…Ø®Ø·Ø· Ù…Ø¨Ø¹Ø«Ø±'],
    answer:'Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ'
  };
}
function g_bestChart_parts(){
  const whole = ['Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø£Ø³Ø±Ø©','ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ…','Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ¬Ø¨Ø©'][rnd(0,2)];
  return {
    text:`Ù†Ø±ÙŠØ¯ ØªÙ…Ø«ÙŠÙ„ Ø£Ø¬Ø²Ø§Ø¡ ${whole} ÙƒÙ†ÙØ³ÙØ¨ Ù…Ù† Ø§Ù„ÙƒÙ„ (100%). Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø£Ù†Ø³Ø¨ØŸ`,
    table:'', hint:'Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† ÙƒÙ„ â†’ Ø¯Ø§Ø¦Ø±ÙŠ',
    options:['Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ','Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ','Ù…Ø®Ø·Ø· Ø£Ø¹Ù…Ø¯Ø©','Ø¬Ø¯ÙˆÙ„'],
    answer:'Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ'
  };
}
function g_makeSimpleTable(){
  const items = ['Ø§Ù„ÙŠÙˆÙ…','Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹','Ø§Ù„Ø´Ù‡Ø±'][rnd(0,2)];
  const start=rnd(2,5), add=rnd(2,6);
  const a=[1,2,3,4].map(i=>start+(i-1)*add);
  const tbl = makeTable([''+items,1,2,3,4], ['Ø§Ù„Ù‚ÙŠÙ…Ø©',...a]);
  return {
    text:`Ø±ØªÙ‘Ø¨/ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢ØªÙŠØ© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù†Ù…Ø· Ø«Ù… Ø­Ø¯Ù‘Ø¯/ÙŠ Ù…Ø§ ÙŠØ­Ø¯Ø« ÙÙŠ ${items} 5.`,
    table:tbl, hint:`Ø²ÙŠØ§Ø¯Ø© Ø«Ø§Ø¨ØªØ© (+${add}).`,
    options:[String(start+4*add), String(start+3*add), String(start+5*add)],
    answer:String(start+4*add)
  };
}

/* Ù…ÙˆÙ„Ø¯Ø§Øª â€” Ù…ØªÙˆØ³Ø· */
function g_rateTable(){
  const speed = rnd(20,60);
  const h1=rnd(1,3), h2=h1+1, h3=h2+1;
  const rows = [
    ['Ø§Ù„Ø²Ù…Ù† (Ø³)',h1,h2,h3],
    ['Ø§Ù„Ù…Ø³Ø§ÙØ© (ÙƒÙ…)',h1*speed,h2*speed,h3*speed]
  ];
  const ask=h3+1, ans=ask*speed;
  return {
    text:`Ø³ÙŠØ§Ø±Ø© ØªØ³ÙŠØ± Ø¨Ø³Ø±Ø¹Ø© Ø«Ø§Ø¨ØªØ©. Ø£ÙƒÙ…ÙÙ„/ÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø«Ù… Ø§Ø­Ø³Ø¨/ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø¹Ø¯ ${ask} Ø³.`,
    table:htmlTable(rows), hint:`Ø§Ù„Ù…Ø³Ø§ÙØ© = Ø§Ù„Ø³Ø±Ø¹Ø© Ã— Ø§Ù„Ø²Ù…Ù†`,
    options:[String(ans),String(ans-speed),String(ans+speed)],
    answer:String(ans)
  };
}
function g_proportionPrice(){
  const price=rnd(300,900); // ÙÙ„Ø³ Ù„ÙƒÙ„ Ù‚Ø·Ø¹Ø©
  const n1=rnd(2,4), n2=n1+1;
  const rows=[['Ø§Ù„Ù‚Ø·Ø¹',n1,n2],['Ø§Ù„Ø³Ø¹Ø± (ÙÙ„Ø³)',n1*price,n2*price]];
  const ask=n2+1, ans=ask*price;
  return {
    text:`Ø«Ù…Ù† Ø§Ù„Ù‚Ø·Ø¹Ø© Ø«Ø§Ø¨Øª. Ù…Ø«Ù‘Ù„/ÙŠ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø«Ù… Ø§Ø­Ø³Ø¨/ÙŠ Ø³Ø¹Ø± ${ask} Ù‚Ø·Ø¹.`,
    table:htmlTable(rows), hint:'Ø§Ù„ØªÙ†Ø§Ø³Ø¨ Ø·Ø±Ø¯ÙŠ.',
    options:[String(ans),String(ans+price),String(ans-price)],
    answer:String(ans)
  };
}
function g_fillMissingArithmetic(){
  const a1=rnd(3,9), d=rnd(2,6);
  const seq=[a1,a1+d,a1+2*d,a1+3*d,a1+4*d,a1+5*d];
  const miss=rnd(1,4);
  const show=seq.map((v,i)=> i===miss?'â€”':v);
  return {
    text:'Ø£ÙƒÙ…ÙÙ„/ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù†Ù…Ø· Ø­Ø³Ø§Ø¨ÙŠ).',
    table:makeTable(['Ø§Ù„Ø®Ø§Ù†Ø©',1,2,3,4,5,6],['Ø§Ù„Ù‚ÙŠÙ…Ø©',...show]),
    hint:`Ø§Ù„ÙØ±Ù‚ Ø«Ø§Ø¨Øª: +${d}`,
    options:[String(seq[miss]), String(seq[miss]+d), String(seq[miss]-d)],
    answer:String(seq[miss])
  };
}
function g_chooseFromText(){
  const ctx = [
    ['Ø£Ø·ÙˆØ§Ù„ Ø£Ø±Ø¨Ø¹Ø© Ø·Ù„Ø§Ø¨','Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø£Ø·ÙˆØ§Ù„ ÙØ¦Ø§Øª Ù‚Ù„ÙŠÙ„Ø©','Ù…Ø®Ø·Ø· Ø£Ø¹Ù…Ø¯Ø©'],
    ['Ø±Ø­Ù„Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙƒÙ„ Ø³Ø§Ø¹Ø©','ØªØºÙŠÙ‘Ø± Ù…Ø³ØªÙ…Ø± Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª','Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ'],
    ['Ù†ØªØ§Ø¦Ø¬ ØªØµÙˆÙŠØª (Ù†ÙØ³ÙØ¨)','Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† ÙƒÙ„','Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ'],
  ][rnd(0,2)];
  return {
    text:`Ù†ØµÙ‘ Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${ctx[0]}. Ø£ÙŠ ØªÙ…Ø«ÙŠÙ„ ØªØ®ØªØ§Ø±/ÙŠÙ†ØŸ (ØªÙ„Ù…ÙŠØ­: ${ctx[1]})`,
    table:'', hint:'Ø§Ø®ØªØ± Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ù„ØºØ±Ø¶.',
    options:['Ù…Ø®Ø·Ø· Ø£Ø¹Ù…Ø¯Ø©','Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ','Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ','Ù…Ø®Ø·Ø· Ù…Ø¨Ø¹Ø«Ø±'],
    answer:ctx[2]
  };
}
function g_timeline(){
  const y = rnd(2005,2015);
  const years=[y,y+1,y+3,y+5];
  const tbl = makeTable(['Ø§Ù„Ø­Ø¯Ø«','A','B','C','D'],['Ø§Ù„Ø³Ù†Ø©',...years]);
  return {
    text:'Ø£ÙŠ ØªÙ…Ø«ÙŠÙ„ ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø²Ù…Ù†ÙŠÙ‹Ø§ Ø¨Ø³Ø±Ø¹Ø©ØŸ',
    table:tbl, hint:'Ù…Ø­ÙˆØ± Ø²Ù…Ù†ÙŠ/Ø®Ø· Ø²Ù…Ù†ÙŠ Ù…Ù†Ø§Ø³Ø¨.',
    options:['Ø®Ø· Ø²Ù…Ù†ÙŠ','Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ','Ù…Ø®Ø·Ø· Ù…Ø¨Ø¹Ø«Ø±','Ù…Ø¯Ø±Ø¬ ØªÙƒØ±Ø§Ø±ÙŠ'],
    answer:'Ø®Ø· Ø²Ù…Ù†ÙŠ'
  };
}

/* Ù…ÙˆÙ„Ø¯Ø§Øª â€” ØµØ¹Ø¨ */
function g_linearModel(){
  const b=rnd(5,15), a=rnd(2,5);
  const days=rnd(2,4);
  const xval=days+1, y=a*xval+b;
  const tbl = makeTable(['Ø§Ù„ÙŠÙˆÙ… x',1,2,3,4], ['Ù‚ÙŠÙ…Ø© y',... [1,2,3,4].map(i=>a*i+b)]);
  return {
    text:`Ù„Ø¯ÙŠÙ†Ø§ Ø¹Ù„Ø§Ù‚Ø© Ø®Ø·ÙŠØ©: y ØªØ²ÙŠØ¯ Ø¨Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª ÙƒÙ„ ÙŠÙˆÙ… ÙˆØ¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© ${b}. Ø§Ø³ØªØ¹Ù…Ù„/ÙŠ Ø¬Ø¯ÙˆÙ„Ù‹Ø§ Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø«Ù… Ø§Ø­Ø³Ø¨/ÙŠ y Ø¹Ù†Ø¯Ù…Ø§ x=${xval}.`,
    table:tbl, hint:`y = ${a}x + ${b}`,
    options:[String(y), String(y+a), String(y-a)],
    answer:String(y)
  };
}
function g_recipeScale(){
  const base=rnd(2,4), mult=rnd(2,4);
  const rows=[['Ø§Ù„Ù…ÙƒÙˆÙ‘Ù†','Ø³ÙƒØ±','Ø¯Ù‚ÙŠÙ‚','Ø­Ù„ÙŠØ¨'],['Ù„ÙƒÙ„ ÙˆØµÙØ©',2,3,1]];
  const ansSugar=2*mult;
  return {
    text:`Ù†Ø±ÙŠØ¯ ØªÙ…Ø«ÙŠÙ„ ØªÙƒØ¨ÙŠØ± ÙˆØµÙØ© Ã—${mult} Ù…Ø±Ø§Øª Ø¨Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø¬Ø¯ÙˆÙ„ ØªÙ†Ø§Ø³Ø¨. ÙƒÙ… ÙƒÙˆØ¨ Ø³ÙƒØ± Ù†Ø­ØªØ§Ø¬ØŸ`,
    table:htmlTable(rows), hint:'Ø§Ù„ØªÙ†Ø§Ø³Ø¨: Ø§Ø¶Ø±Ø¨/ÙŠ ÙƒÙ„ Ø§Ù„Ù…Ù‚Ø§Ø¯ÙŠØ± ÙÙŠ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙƒØ¨ÙŠØ±.',
    options:[String(ansSugar),String(ansSugar+1),String(ansSugar-1)],
    answer:String(ansSugar)
  };
}
function g_seatingPattern(){
  const a=rnd(3,5); // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ ÙÙŠ Ø£ÙˆÙ„ ØµÙ
  const d=rnd(1,3);
  const n=rnd(4,6);
  const seq=[...Array(n)].map((_,i)=>a+i*d);
  const next=a+n*d;
  return {
    text:`ØµÙÙˆÙ Ù…Ù‚Ø§Ø¹Ø¯ ØªØ²ÙŠØ¯ Ø¨Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª. Ø§Ø³ØªØ®Ø¯Ù…/ÙŠ Ø¬Ø¯ÙˆÙ„Ù‹Ø§ Ø«Ù… Ø­Ø¯Ù‘Ø¯/ÙŠ Ø¹Ø¯Ø¯ Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„ØµÙ ${n+1}.`,
    table:makeTable(['Ø§Ù„ØµÙ',1,2,3,4,5].slice(0,n+1), ['Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯',...seq]),
    hint:`Ù†Ù…Ø· Ø­Ø³Ø§Ø¨ÙŠ: +${d}`,
    options:[String(next),String(next+d),String(next-d)],
    answer:String(next)
  };
}
function g_selectScatter(){
  return {
    text:'Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© ÙˆØ§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©ØŒ Ø£ÙŠ ØªÙ…Ø«ÙŠÙ„ ØªØ®ØªØ§Ø±/ÙŠÙ†ØŸ',
    table:'', hint:'Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ù…ØªØºÙŠÙ‘Ø±ÙŠÙ† Ø¹Ø¯Ø¯ÙŠÙŠÙ† â†’ Ù…Ø¨Ø¹Ø«Ø±',
    options:['Ù…Ø®Ø·Ø· Ù…Ø¨Ø¹Ø«Ø±','Ù…Ø®Ø·Ø· Ø£Ø¹Ù…Ø¯Ø©','Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ','Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø·'],
    answer:'Ù…Ø®Ø·Ø· Ù…Ø¨Ø¹Ø«Ø±'
  };
}

/* Ø¨Ù†Ø§Ø¡ 30 Ø³Ø¤Ø§Ù„ Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± ÙˆØ¨ØªØ±ØªÙŠØ¨ Ø³Ù‡Ù„â†’Ù…ØªÙˆØ³Ø·â†’ØµØ¹Ø¨ */
function buildQuestions(){
  const used = new Set();
  const out  = [];
  function pushUnique(gen, n, tries=60){
    for(let k=0;k<n;k++){
      let t=0, q;
      do{ q = gen(); t++; }while(t<tries && used.has(q.text));
      if(!used.has(q.text)){ used.add(q.text); out.push(q); }
    }
  }

  // Ø³Ù‡Ù„ (12)
  pushUnique(g_bestChart_count, 4);
  pushUnique(g_bestChart_time , 4);
  pushUnique(g_bestChart_parts, 2);
  pushUnique(g_makeSimpleTable , 2);

  // Ù…ØªÙˆØ³Ø· (12)
  pushUnique(g_rateTable         , 4);
  pushUnique(g_proportionPrice   , 3);
  pushUnique(g_fillMissingArithmetic,3);
  pushUnique(g_chooseFromText    , 2);
  // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø²Ù…Ù†ÙŠ
  pushUnique(g_timeline          , 1); // Ø³ÙŠØ²ÙŠØ¯ Ø§Ù„Ø¹Ø¯Ø¯ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¥Ù† Ù†Ù‚Øµ

  // ØµØ¹Ø¨ (6)
  pushUnique(g_linearModel , 2);
  pushUnique(g_recipeScale , 2);
  pushUnique(g_seatingPattern,1);
  pushUnique(g_selectScatter ,1);

  // Ø¥ÙƒÙ…Ø§Ù„/nÙ‚Øµ Ø­ØªÙ‰ 30 Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
  const gens=[g_bestChart_count,g_bestChart_time,g_bestChart_parts,g_makeSimpleTable,g_rateTable,g_proportionPrice,g_fillMissingArithmetic,g_chooseFromText,g_timeline,g_linearModel,g_recipeScale,g_seatingPattern,g_selectScatter];
  let guard=1000;
  while(out.length<TOTAL_Q && guard--){
    const q = gens[rnd(0,gens.length-1)]();
    if(!used.has(q.text)){ used.add(q.text); out.push(q); }
  }
  return out.slice(0,TOTAL_Q);
}

/* Ø¬Ø¯Ø§ÙˆÙ„ HTML */
function makeTable(headersRow, dataRow){ return htmlTable([headersRow, dataRow]); }
function htmlTable(rows){
  let thead = '<thead><tr>'+ rows[0].map(c=>`<th>${c}</th>`).join('') +'</tr></thead>';
  let body  = rows.slice(1).map(r=>'<tr>'+r.map(c=>`<td>${c}</td>`).join('')+'</tr>').join('');
  return `<table class="table">${thead}<tbody>${body}</tbody></table>`;
}

/* ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© */
let QUESTIONS = [];
let idx = 0, score = 0, timeLeft = TIME_LIMIT, timer = null, running=false;

function render(q){
  counterEl.textContent = `${idx+1} / ${TOTAL_Q}`;
  qEl.textContent       = q.text;
  workEl.innerHTML      = q.table || '';
  hintEl.textContent    = q.hint || '';
  choicesEl.innerHTML   = '';
  q.options.forEach(opt=>{
    const b = document.createElement('button');
    b.className = 'choice';
    b.textContent = opt;
    b.onclick = ()=> choose(opt, q.answer, b);
    choicesEl.appendChild(b);
  });
}

function choose(sel, ans, btn){
  if(String(sel)===String(ans)){
    btn.classList.add('correct');
    score++; scoreEl.textContent = score;
    setTimeout(()=>{
      idx++;
      if(idx>=TOTAL_Q){ win(); }
      else render(QUESTIONS[idx]);
    },140);
  } else {
    btn.classList.add('wrong');
    setTimeout(()=>{ window.location.href='index.html'; },140);
  }
}

function start(){
  if(running) return;
  running = true; doneEl.hidden=true;
  QUESTIONS = buildQuestions();
  idx=0; score=0; scoreEl.textContent=score;
  timeLeft = TIME_LIMIT; timeEl.textContent=timeLeft;
  render(QUESTIONS[idx]);
  startBtn.disabled = true; startBtn.textContent = 'Ø¬Ø§Ø±ÙŠâ€¦';
  clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--; timeEl.textContent=timeLeft;
    if(timeLeft<=0){
      clearInterval(timer);
      window.location.href = 'index.html';
    }
  },1000);
}

function win(){
  clearInterval(timer);
  qEl.textContent='Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± âœ…';
  workEl.innerHTML=''; hintEl.textContent='';
  choicesEl.innerHTML='';
  doneEl.hidden=false; startBtn.disabled=false; startBtn.textContent='Ø¥Ø¹Ø§Ø¯Ø©';
  running=false;
}

document.getElementById('startBtn').addEventListener('click', start);
</script>
</body>
</html>
