<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .qa { font-size: 22px; margin: 12px 0; }
    .actions { display:flex; gap:8px; justify-content:center; margin:10px 0; }
    .actions button{ padding:10px 16px; border:1px solid #000; cursor:pointer; font-weight:700; }
    .btn-true{ background:#c8e6c9; }
    .btn-false{ background:#ffcdd2; }
    .result { margin-top:12px; font-weight:700; }
    .badge { display:inline-block; padding:4px 10px; border:1px solid #000; margin-inline-start:4px; }
  </style>
</head>
<body>

  <main>
    <section>
      <div class="container">
        <div class="status-bar">
          <div class="time">Ø§Ù„ÙˆÙ‚Øª : <span id="time">180</span></div>
          <div class="start" style="border:1px solid #000;">Ø§Ù„Ù„Ø§Ø¹Ø¨: <span id="playerLabel">â€”</span></div>
          <div class="score">Ø§Ù„Ù†Ù‚Ø§Ø· : <span id="score">0</span></div>
        </div>

        <h2>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø¶Ø±Ø¨ (3 Ø¹ÙˆØ§Ù…Ù„)</h2>
        <div style="margin-bottom:8px">
          Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="levelName" class="badge">Ø³Ù‡Ù„</span>
        </div>

        <div class="qa">
          <div id="question">â€” Ã— â€” Ã— â€” = â€”</div>
          <div class="actions">
            <button class="btn-true" id="btnTrue">ØµØ­ÙŠØ­ âœ“</button>
            <button class="btn-false" id="btnFalse">Ø®Ø·Ø£ âœ—</button>
          </div>
        </div>

        <div id="message" class="result"></div>

        <footer>Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚! Ø«Ø¨Ù‘Øª ØªØ±ÙƒÙŠØ²Ùƒ ÙˆØ³Ø±Ù‘Ø¹ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ ğŸ‘Œ</footer>
      </div>
    </section>
  </main>

  <script>
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    const playerName = (localStorage.getItem('playerName') || 'Ù„Ø§Ø¹Ø¨');
    document.getElementById('playerLabel').textContent = playerName;

    const timeEl = document.getElementById('time');
    const scoreEl = document.getElementById('score');
    const qEl = document.getElementById('question');
    const msgEl = document.getElementById('message');
    const levelEl = document.getElementById('levelName');

    const btnTrue = document.getElementById('btnTrue');
    const btnFalse = document.getElementById('btnFalse');

    let time = 180;
    let score = 0;

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    let a = 0, b = 0, c = 0, right = 0, shown = 0;

    // Ø«Ø§Ø¨Øª Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯
    const FIXED_POOL = [2, 4, 5];

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
    function getDifficulty(score){
      if (score <= 5) return 'easy';
      if (score <= 15) return 'medium';
      return 'hard';
    }

    function rand(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function setLevelLabel(diff){
      if (diff === 'easy') levelEl.textContent = 'Ø³Ù‡Ù„';
      else if (diff === 'medium') levelEl.textContent = 'Ù…ØªÙˆØ³Ø·';
      else levelEl.textContent = 'ØµØ¹Ø¨';
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
    function newQuestion(){
      const diff = getDifficulty(score);
      setLevelLabel(diff);

      // Ù†Ø·Ø§Ù‚ Ø§Ù„Ù‚ÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
      let minV = 1, maxV = 9, maxOffset = 6;
      if (diff === 'medium'){ minV = 2; maxV = 12; maxOffset = 10; }
      if (diff === 'hard'){   minV = 3; maxV = 15; maxOffset = 14; }

      // Ø§Ø®ØªØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ©
      const fixedVal = FIXED_POOL[rand(0, FIXED_POOL.length - 1)];

      // Ø¶Ø¹ Ø§Ù„Ø«Ø§Ø¨Øª ÙÙŠ Ø®Ø§Ù†Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„Ø«Ù„Ø§Ø«Ø©
      const pos = rand(0, 2);
      const vals = [0, 0, 0];
      vals[pos] = fixedVal;

      // Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù‚ÙŠÙ… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
      for (let i = 0; i < 3; i++){
        if (i === pos) continue;
        vals[i] = rand(minV, maxV);
      }

      [a, b, c] = vals;
      right = a * b * c;

      // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù…Ù‚ØªØ±Ø­: ØµØ­ÙŠØ­ Ø£Ùˆ Ø®Ø§Ø·Ø¦
      const makeCorrect = Math.random() < 0.5;
      if (makeCorrect){
        shown = right;
      } else {
        let offset = rand(-maxOffset, maxOffset);
        if (offset === 0) offset = 3;
        shown = right + offset;
        if (shown <= 0) shown = right + Math.abs(offset) + 3;
      }

      qEl.textContent = `${a} Ã— ${b} Ã— ${c} = ${shown}`;
      msgEl.textContent = '';
    }

    function endGame(reason){
      btnTrue.disabled = true;
      btnFalse.disabled = true;
      msgEl.textContent = reason === 'time'
        ? `Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ù†ØªÙŠØ¬ØªÙƒ: ${score}`
        : `Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${right}. Ù†ØªÙŠØ¬ØªÙƒ: ${score}`;

      setTimeout(()=> { window.location.href = 'index.html'; }, 2500);
    }

    function tick(){
      time--;
      timeEl.textContent = time;
      if (time <= 0){
        clearInterval(timer);
        endGame('time');
      }
    }

    btnTrue.addEventListener('click', ()=>{
      const isCorrect = (shown === right);
      if (isCorrect){
        score++; scoreEl.textContent = score; newQuestion();
      } else {
        clearInterval(timer);
        endGame('wrong');
      }
    });

    btnFalse.addEventListener('click', ()=>{
      const isCorrect = (shown !== right);
      if (isCorrect){
        score++; scoreEl.textContent = score; newQuestion();
      } else {
        clearInterval(timer);
        endGame('wrong');
      }
    });

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    newQuestion();
    const timer = setInterval(tick, 1000);
  </script>

</body>
</html>
