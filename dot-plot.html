<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body{font-family:'Tahoma',sans-serif;background:#f9f6ff;margin:0;color:#111;text-align:center}
    h1{margin:16px 0 6px}
    .status-bar{display:flex;justify-content:space-between;gap:12px;padding:12px 20px}
    .time,.score{font-weight:bold;padding:8px 15px;border-radius:8px}
    .time{background:#ffe0ef;color:#900}
    .score{background:#e0edff;color:#003366}
    .board{max-width:1100px;margin:14px auto;padding:14px}
    .plot{background:#fff;border:1px dashed #cbd5e1;border-radius:12px;padding:16px}
    .axis{display:flex;justify-content:center;gap:22px;align-items:flex-end;flex-wrap:wrap}
    .tick{min-width:42px;display:flex;flex-direction:column;align-items:center;gap:8px}
    .dots{min-height:120px;display:flex;flex-direction:column-reverse;gap:6px}
    .dot{font-weight:900;line-height:1}
    .xlabel{font-weight:700;margin-top:4px}
    .question-box{margin:16px auto 28px;padding:16px;border:1px solid #ccc;border-radius:10px;width:min(780px,92%);background:#fff0ff}
    .qtext{font-size:20px;margin:0 0 10px}
    .answers{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .answers button{padding:10px 18px;border:1px solid #aaa;border-radius:8px;background:#f9f9f9;cursor:pointer}
    .answers button:hover{background:#eee}
    footer{margin:18px 0 26px;color:#333}
  </style>
</head>
<body>
  <h1>Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·</h1>
  <p>Ù„Ø¯ÙŠÙƒ 180 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§. Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£ØªØŒ Ø³ØªØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>

  <div class="status-bar">
    <span class="time">â° Ø§Ù„ÙˆÙ‚Øª: <span id="time">180</span> Ø«Ø§Ù†ÙŠØ©</span>
    <span class="score">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></span>
  </div>

  <div class="board">
    <div class="plot">
      <h3 id="title" style="margin:0 0 8px">â€”</h3>
      <div id="axis" class="axis"></div>
    </div>

    <div class="question-box">
      <h2 class="qtext" id="question">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</h2>
      <div class="answers" id="answers"></div>
    </div>
  </div>

  <footer>Ø¥Ø¹Ø¯Ø§Ø¯: Ø£.Ø¨ÙŠØ§Ù† Ø¬Ø¹ÙØ± Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø²Ø§Ù‚ Ø¹Ø¨Ø§Ø³</footer>

<script>
/* ============= 1) Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø«Ù„ Ø§Ù„Ù…Ù„Ø²Ù…Ø© ============= */
// (Ø£) Ø§Ù„Ù‚ØµØµ
const STORIES = {
  title:'Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØµ Ø§Ù„ØªÙŠ ÙŠÙ…ØªÙ„ÙƒÙ‡Ø§ Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³',
  min:0, max:12, step:1,
  // Ø¹Ø¯Ù‘Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø±Ø§Ø­ØªÙƒ: Ù‚ÙŠÙ…Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨
  data:[1,2,2,3,3,3,4,5,6,7,7,8,9,9,10,10,11,12]
};
// (Ø¨) Ø§Ù„Ø£ÙˆØ²Ø§Ù† (ÙƒØ¬Ù…)
const WEIGHTS = {
  title:'Ø£ÙˆØ²Ø§Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø£Ø·ÙØ§Ù„ (ÙƒØ¬Ù…)',
  min:16, max:30, step:1,
  data:[18,18,19,20,20,21,22,22,22,23,24,24,25,26,27,28,29,29]
};

/* ============= 2) Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ø§Ù„Ù†Ù‚Ø§Ø· Ã— Ø¹Ù„Ù‰ Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ ============= */
const axisEl = document.getElementById('axis');
function countMap(arr){
  const m=new Map(); arr.forEach(v=>m.set(v,(m.get(v)||0)+1)); return m;
}
function drawDotPlot(ds){
  axisEl.innerHTML='';
  const freq=countMap(ds.data);
  for(let x=ds.min; x<=ds.max; x+=ds.step){
    const tick=document.createElement('div'); tick.className='tick';
    const dots=document.createElement('div'); dots.className='dots';
    const n=freq.get(x)||0;
    for(let i=0;i<n;i++){ const d=document.createElement('div'); d.className='dot'; d.textContent='Ã—'; dots.appendChild(d); }
    const lab=document.createElement('div'); lab.className='xlabel'; lab.textContent=x;
    tick.appendChild(dots); tick.appendChild(lab); axisEl.appendChild(tick);
  }
}

/* ============= 3) ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†ÙØ³ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ÙˆØ±Ù‚Ø© ============= */
function makeMCQNumber(correct, deltas=[-1,1,2]){
  const s=new Set([correct]); deltas.forEach(d=>s.add(correct+d)); 
  return Array.from(s).filter(v=>v>=0).slice(0,3).sort(()=>Math.random()-0.5).map(String);
}
function mode(arr){
  const m=countMap(arr); let best=null,c=-1;
  m.forEach((v,k)=>{ if(v>c){c=v;best=k;} }); return best;
}

// Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù‚ØµØµ
function storyQuestions(ds){
  const m=countMap(ds.data), out=[];
  const c3=m.get(3)||0;
  out.push({ds, text:'Ù…Ø§ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… 3 Ù‚ØµØµØŸ', answer:String(c3), options:makeMCQNumber(c3,[-1,1,2,3])});
  const ge10=ds.data.filter(v=>v>=10).length;
  out.push({ds, text:'Ù…Ø§ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… 10 Ù‚ØµØµ ÙˆØ£ÙƒØ«Ø±ØŸ', answer:String(ge10), options:makeMCQNumber(ge10)});
  const le4=ds.data.filter(v=>v<=4).length;
  out.push({ds, text:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… 4 Ù‚ØµØµ ÙØ£Ù‚Ù„ØŸ', answer:String(le4), options:makeMCQNumber(le4,[-2,-1,1,2])});
  const md=mode(ds.data);
  out.push({ds, text:'Ù…Ø§ Ø§Ù„Ù…Ù†ÙˆØ§Ù„ (Ø£ÙƒØ«Ø± Ø¹Ø¯Ø¯ Ù‚ØµØµ ØªÙƒØ±Ø§Ø±Ù‹Ø§)ØŸ', answer:String(md), options:makeMCQNumber(md)});
  return out;
}

// Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£ÙˆØ²Ø§Ù†
function weightQuestions(ds){
  const m=countMap(ds.data), out=[];
  const w4 = Number([...m.entries()].find(([w,c])=>c===4)?.[0] ?? NaN);
  if(!Number.isNaN(w4)){
    const near=[w4-1,w4+1,w4+2].filter(x=>x>=ds.min&&x<=ds.max);
    const options=[String(w4), ...near.map(String)].sort(()=>Math.random()-0.5).slice(0,3);
    out.push({ds, text:'Ù…Ø§ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø°ÙŠ ÙˆÙØ¬Ø¯ ÙÙŠÙ‡ 4 Ø£Ø·ÙØ§Ù„ØŸ', answer:String(w4), options});
  }
  const ge22=ds.data.filter(v=>v>=22).length;
  out.push({ds, text:'Ù…Ø§ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø°ÙŠÙ† Ø£ÙˆØ²Ø§Ù†Ù‡Ù… 22 ÙƒØ¬Ù… ÙˆØ£ÙƒØ¨Ø±ØŸ', answer:String(ge22), options:makeMCQNumber(ge22)});
  const lt20=ds.data.filter(v=>v<20).length;
  out.push({ds, text:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø°ÙŠÙ† Ø£ÙˆØ²Ø§Ù†Ù‡Ù… Ø£Ù‚Ù„ Ù…Ù† 20 ÙƒØ¬Ù…ØŸ', answer:String(lt20), options:makeMCQNumber(lt20)});
  const md=mode(ds.data);
  out.push({ds, text:'Ù…Ø§ Ø§Ù„Ù…Ù†ÙˆØ§Ù„ (Ø£ÙƒØ«Ø± ÙˆØ²Ù† ØªÙƒØ±Ø§Ø±Ù‹Ø§)ØŸ', answer:String(md), options:makeMCQNumber(md)});
  return out;
}

/* ============= 4) Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªØ´ØºÙŠÙ„ ============= */
const BANK=[...storyQuestions(STORIES), ...weightQuestions(WEIGHTS)];
const QUESTIONS=BANK; // ØªÙ‚Ø¯Ø±ÙŠ ØªÙ‚Ù„Ù„ÙŠ/ØªØ²ÙˆØ¯ÙŠ Ø¨Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù‡Ù†Ø§

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
const titleEl=document.getElementById('title');
const qEl=document.getElementById('question');
const ansEl=document.getElementById('answers');
const scoreEl=document.getElementById('score');
const timeEl=document.getElementById('time');

let i=0, score=0, timeLeft=180, timer=null;

function render(){
  if(i>=QUESTIONS.length){
    alert('Ø£Ø­Ø³Ù†Øª! Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ğŸ‘');
    window.location.href='index.html'; return;
  }
  const item=QUESTIONS[i];
  titleEl.textContent=item.ds.title;
  drawDotPlot(item.ds);
  qEl.textContent=`(${i+1} / ${QUESTIONS.length}) ${item.text}`;
  ansEl.innerHTML='';
  item.options.forEach(op=>{
    const b=document.createElement('button');
    b.textContent=op;
    b.onclick=()=>check(op,item.answer);
    ansEl.appendChild(b);
  });
}
function check(sel, correct){
  if(String(sel)===String(correct)){
    score++; scoreEl.textContent=score; i++; render();
  }else{
    clearInterval(timer);
    alert('Ø®Ø·Ø£! Ø³ØªØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.');
    window.location.href='index.html';
  }
}
function startTimer(){
  timer=setInterval(()=>{
    timeLeft--; timeEl.textContent=timeLeft;
    if(timeLeft<=0){
      clearInterval(timer);
      alert('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!');
      window.location.href='index.html';
    }
  },1000);
}

startTimer();
render();
</script>
</body>
</html>
