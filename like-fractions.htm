<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©: Ø¬Ù…Ø¹ ÙˆØ·Ø±Ø­Ù‡Ø§ â€” 30 Ø³Ø¤Ø§Ù„ / 180 Ø«Ø§Ù†ÙŠØ©</title>
  <style>
    :root{
      --bg:#f8f6fb; --ink:#111827; --muted:#6b7280; --border:#e5e7eb;
      --panel:#fff; --panel2:#faf5ff; --accent:#7c3aed; --ok:#16a34a; --bad:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:"Segoe UI",Tahoma,Arial,sans-serif}
    .wrap{max-width:1100px;margin:auto;padding:20px}
    header{text-align:center}
    h1{margin:8px 0 4px}
    .subtitle{color:var(--muted)}
    .status{display:flex;justify-content:space-between;gap:10px;background:var(--panel2);
            border:1px solid var(--border);padding:10px;border-radius:12px;margin-top:12px}
    .chip{font-weight:700;padding:8px 12px;border-radius:10px;background:#e0e7ff}
    .chip.time{background:#ffe4e6}
    .card{margin-top:16px;background:var(--panel);border:1px solid var(--border);
          border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    .qbar{background:#ede9fe;border:1px solid #ddd6fe;border-radius:10px;padding:14px;margin-bottom:12px}
    .qbar h2{margin:0;text-align:center;font-size:clamp(18px,3.6vw,26px)}
    .work{display:flex;justify-content:center;gap:18px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .frac{display:inline-grid;grid-template-rows:auto auto;place-items:center;margin:0 6px}
    .frac .top{border-bottom:2px solid #111;padding:0 6px;font-weight:700}
    .frac .bot{padding:0 6px;font-weight:700}
    .choices{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
    .choice{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px 16px;cursor:pointer;min-width:150px;font-weight:700}
    .choice:hover{filter:brightness(.98)}
    .choice.correct{background:#ecfdf5;border-color:#bbf7d0}
    .choice.wrong{background:#fef2f2;border-color:#fecaca}
    .actions{display:flex;justify-content:center;margin-top:10px}
    .btn{border:1px solid var(--border);background:#eef2ff;border-radius:10px;padding:10px 16px;cursor:pointer}
    .note{color:var(--muted);text-align:center;margin-top:6px}
    footer{margin-top:18px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©: Ø¬Ù…Ø¹ ÙˆØ·Ø±Ø­Ù‡Ø§</h1>
      <p class="subtitle">ØªØ¯Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø¬Ù…Ø¹ ÙˆØ·Ø±Ø­ Ø§Ù„ÙƒØ³ÙˆØ± Ø°Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© ÙˆØ¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø£Ø¨Ø³Ø· ØµÙˆØ±Ø©. Ù„Ø¯ÙŠÙƒ 180 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ 30 Ø³Ø¤Ø§Ù„Ù‹Ø§. Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª ÙØ³ØªØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>
    </header>

    <div class="status">
      <div class="chip">Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="counter">0 / 30</span></div>
      <div class="chip">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
      <div class="chip time">â° Ø§Ù„ÙˆÙ‚Øª: <span id="time">180</span> Ø«Ø§Ù†ÙŠØ©</div>
    </div>

    <section class="card">
      <div class="qbar"><h2 id="question">Ø§Ø¶ØºØ·/ÙŠ Ø§Ø¨Ø¯Ø£ Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!</h2></div>
      <div class="work" id="workArea"></div>
      <p class="note" id="hint"></p>
      <div class="choices" id="choices"></div>
      <div class="actions"><button class="btn" id="startBtn">Ø§Ø¨Ø¯Ø£ â–¶ï¸</button></div>
    </section>

    <footer id="done" hidden>Ø£Ø­Ø³Ù†Øª! Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø© ğŸ‰</footer>
  </div>

<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© */
const TIME_LIMIT = 180;
const TOTAL_Q    = 30;

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
const counterEl = document.getElementById('counter');
const scoreEl   = document.getElementById('score');
const timeEl    = document.getElementById('time');
const qEl       = document.getElementById('question');
const workEl    = document.getElementById('workArea');
const hintEl    = document.getElementById('hint');
const choicesEl = document.getElementById('choices');
const startBtn  = document.getElementById('startBtn');
const doneEl    = document.getElementById('done');

/* Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© */
const rnd = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
const shuffle = a => a.sort(()=>Math.random()-0.5);
const gcd = (a,b)=> b?gcd(b,a%b):Math.abs(a);
function simp(n,d){ const g=gcd(n,d); return [n/g, d/g]; }
function fracHTML(n,d){ return `<span class="frac"><span class="top">${n}</span><span class="bot">${d}</span></span>`; }
function renderOp(op,lhs1,lhs2,den){ // lhs1, lhs2 numerators
  const a = fracHTML(lhs1,den);
  const b = fracHTML(lhs2,den);
  return `${a} <strong>${op}</strong> ${b}`;
}
function optsFrom(fr){ // fr is [n,d] simplest
  const [n,d]=fr;
  const wrong1 = simp(n+1,d)[0]+'/'+simp(n+1,d)[1];
  const wrong2 = (n>1? simp(n-1,d) : [n+2,d]).join('/');
  return shuffle([`${n}/${d}`, wrong1, wrong2]);
}

/* Ù…ÙˆÙ„Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
// 1) Ø¬Ù…Ø¹ Ø¨Ø³ÙŠØ· Ø³Ù‡Ù„
function q_add_easy(){
  const den = [2,3,4,5,6,8,10,12][rnd(0,7)];
  const a=rnd(1,Math.floor(den/3));
  const b=rnd(1,Math.floor(den/3));
  const [n,d]=simp(a+b,den);
  return {
    text:'Ø§Ø¬Ù…Ø¹/ÙŠ Ùˆ Ø§ÙƒØªØ¨/ÙŠ Ø§Ù„Ù†Ø§ØªØ¬ ÙÙŠ Ø£Ø¨Ø³Ø· ØµÙˆØ±Ø©:',
    work: renderOp('+',a,b,den),
    hint:'Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø³Ø·ÙŠÙ† ÙˆØ§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ù…Ù‚Ø§Ù… Ù†ÙØ³Ù‡ØŒ Ø«Ù… Ø¨Ø³Ù‘Ø·.',
    options: optsFrom([n,d]),
    answer: `${n}/${d}`
  };
}
// 2) Ø·Ø±Ø­ Ø¨Ø³ÙŠØ· Ø³Ù‡Ù„ (Ù†Ø§ØªØ¬ Ù…ÙˆØ¬Ø¨)
function q_sub_easy(){
  const den = [4,5,6,8,10,12][rnd(0,5)];
  const a=rnd(2,Math.floor(den/2));
  const b=rnd(1,a-1);
  const [n,d]=simp(a-b,den);
  return {
    text:'Ø§Ø·Ø±Ø­/ÙŠ Ùˆ Ø¨Ø³Ù‘Ø·/ÙŠ:',
    work: renderOp('âˆ’',a,b,den),
    hint:'Ø§Ø·Ø±Ø­ Ø§Ù„Ø¨Ø³Ø·ÙŠÙ† Ù…Ø¹ Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù…ØŒ Ø«Ù… Ø¨Ø³Ù‘Ø·.',
    options: optsFrom([n,d]),
    answer: `${n}/${d}`
  };
}
// 3) Ø¬Ù…Ø¹ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø¹Ø¯Ø¯ ÙƒØ³Ø±ÙŠ (ØªØ¨Ø³ÙŠØ· Ø¥Ù„Ù‰ ÙƒØ³Ø± ØºÙŠØ± ÙØ¹Ù„ÙŠ/ÙØ¹Ù„ÙŠ Ù…Ø¨Ø³Ø·)
function q_add_bigger(){
  const den = [6,8,9,10,12][rnd(0,4)];
  const a=rnd(Math.floor(den/3), Math.floor(den/2));
  const b=rnd(Math.floor(den/3), Math.floor(den/2));
  const [n,d]=simp(a+b,den);
  return {
    text:'Ø§Ø¬Ù…Ø¹/ÙŠ ÙˆØ§Ø¨Ø³Ø·/ÙŠ Ø§Ù„Ù†Ø§ØªØ¬ Ø¥Ù„Ù‰ Ø£Ø¨Ø³Ø· ØµÙˆØ±Ø©:',
    work: renderOp('+',a,b,den),
    hint:'Ù‚Ø¯ ØªØ­ØªØ§Ø¬/ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ØªØ¨Ø³ÙŠØ· ÙÙ‚Ø· (Ø§Ù„Ù…Ù‚Ø§Ù… Ø«Ø§Ø¨Øª).',
    options: optsFrom([n,d]),
    answer: `${n}/${d}`
  };
}
// 4) Ø·Ø±Ø­ Ø£ØµØ¹Ø¨ (Ø£Ø±Ù‚Ø§Ù… Ø£ÙƒØ¨Ø±)
function q_sub_hard(){
  const den = [6,8,10,12][rnd(0,3)];
  const a=rnd(Math.ceil(den/2), den-1);
  const b=rnd(1, Math.ceil(den/2));
  if(a<=b) return q_sub_hard(); // ØªØ£ÙƒØ¯ Ù…ÙˆØ¬Ø¨
  const [n,d]=simp(a-b,den);
  return {
    text:'Ø§Ø·Ø±Ø­/ÙŠ ÙˆØ§Ø¨Ø³Ù‘Ø·/ÙŠ:',
    work: renderOp('âˆ’',a,b,den),
    hint:'Ø§Ø·Ø±Ø­ Ø§Ù„Ø¨Ø³Ø·ÙŠÙ† Ø«Ù… Ø¨Ø³Ù‘Ø· Ø§Ù„ÙƒØ³Ø±.',
    options: optsFrom([n,d]),
    answer: `${n}/${d}`
  };
}
// 5) Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨Ø³Ø· Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ ÙÙŠ Ø¬Ù…Ø¹
function q_fill_add(){
  const den = [6,8,10,12][rnd(0,3)];
  const a=rnd(1,Math.floor(den/2));
  const target=rnd(1,den-1);
  const b = (target - a); // a + b = target
  if(b<=0 || b>=den) return q_fill_add();
  const [n,d]=simp(target,den);
  const work = `${fracHTML(a,den)} <strong>+</strong> ${fracHTML('ØŸ',den)} = ${fracHTML(n,d)}`;
  const opts = shuffle([b, b+1, Math.max(1,b-1)]).map(x=>String(x));
  return {
    text:'Ø£ÙƒÙ…ÙÙ„/ÙŠ Ø§Ù„Ø¨Ø³Ø· Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¨Ø³Ù‘Ø·:',
    work, hint:'Ø­ÙˆÙ‘Ù„ Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù…Ø¨Ø³Ù‘Ø· Ø¥Ù„Ù‰ Ù…Ù‚Ø§Ù… Ø£ØµÙ„ÙŠ Ø«Ù… Ø§Ø³ØªÙ†ØªØ¬ Ø§Ù„Ø¨Ø³Ø· Ø§Ù„Ù…ÙÙ‚ÙˆØ¯.',
    options: opts, answer: String(b)
  };
}
// 6) Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨Ø³Ø· ÙÙŠ Ø·Ø±Ø­
function q_fill_sub(){
  const den = [6,8,10,12][rnd(0,3)];
  const a=rnd(2,den-1);
  const target=rnd(1,a-1);
  const b = (a - target);
  const [n,d]=simp(target,den);
  const work = `${fracHTML(a,den)} <strong>âˆ’</strong> ${fracHTML('ØŸ',den)} = ${fracHTML(n,d)}`;
  const opts = shuffle([b, b+1, Math.max(1,b-1)]).map(String);
  return {
    text:'Ø£ÙƒÙ…ÙÙ„/ÙŠ Ø§Ù„Ø¨Ø³Ø· Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ø·Ø±Ø­ (Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø¨Ø³Ù‘Ø·Ø©):',
    work, hint:'Ø£Ø¹ÙŠØ¯ÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø§Ù… Ø§Ù„Ø£ØµÙ„ÙŠ Ø«Ù… Ø§Ø³ØªØ®Ø±Ø¬ÙŠ Ø§Ù„Ø¨Ø³Ø· Ø§Ù„Ù…ÙÙ‚ÙˆØ¯.',
    options: opts, answer: String(b)
  };
}
// 7) Ù…Ø³Ø£Ù„Ø© Ù„ÙØ¸ÙŠØ© Ù‚ØµÙŠØ±Ø© (Ø¨ÙŠØªØ²Ø§/Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©) â€” Ø¬Ù…Ø¹
function q_word_add(){
  const den = [4,6,8,10][rnd(0,3)];
  const a=rnd(1,Math.floor(den/2));
  const b=rnd(1,Math.floor(den/2));
  const [n,d]=simp(a+b,den);
  const item = ['Ø¨ÙŠØªØ²Ø§','Ù„ÙˆØ­ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©','ÙƒÙŠÙƒØ©'][rnd(0,2)];
  return {
    text:`Ø£ÙƒÙ„ Ø¹Ù„ÙŠ ${a}/${den} Ù…Ù† ${item}ØŒ ÙˆØ£ÙƒÙ„Øª Ø£Ø±ÙˆÙ‰ ${b}/${den} Ù…Ù†Ù‡Ø§. ÙƒÙ… Ø£ÙƒÙ„Ø§ Ù…Ø¹Ù‹Ø§ØŸ (Ø£Ø¨Ø³Ø· ØµÙˆØ±Ø©)`,
    work:'', hint:'Ù…Ù‚Ø§Ù…Ø§Øª Ù…ØªØ³Ø§ÙˆÙŠØ© â†’ Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø³Ø·ÙŠÙ†.',
    options: optsFrom([n,d]),
    answer: `${n}/${d}`
  };
}
// 8) Ù…Ø³Ø£Ù„Ø© Ù„ÙØ¸ÙŠØ© â€” Ø·Ø±Ø­
function q_word_sub(){
  const den = [4,6,8,10,12][rnd(0,4)];
  const a=rnd(2,den-1);
  const b=rnd(1,a-1);
  const [n,d]=simp(a-b,den);
  const item = ['Ø¹ØµÙŠØ±','ÙˆØ§Ø¬Ø¨','Ø·Ø±ÙŠÙ‚'][rnd(0,2)];
  return {
    text:`Ø§Ø³ØªÙ‡Ù„ÙƒØª Ø³Ø§Ø±Ø© ${a}/${den} Ù…Ù† ${item}ØŒ Ø«Ù… Ø£Ø¹Ø§Ø¯Øª ${b}/${den}. ÙƒÙ… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ/Ø§Ù„ØªØºÙŠÙŠØ±ØŸ (Ø£Ø¨Ø³Ø· ØµÙˆØ±Ø©)`,
    work:'', hint:'Ø§Ø·Ø±Ø­ Ø§Ù„Ø¨Ø³Ø·ÙŠÙ† Ù…Ø¹ Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù….',
    options: optsFrom([n,d]),
    answer: `${n}/${d}`
  };
}

/* Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ù…Ø±ØªÙ‘Ø¨ Ø³Ù‡Ù„â†’Ù…ØªÙˆØ³Ø·â†’ØµØ¹Ø¨ ÙˆØ¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ */
function buildQuestions(){
  const out=[], used=new Set();
  const add = (gen, n)=>{ for(let i=0;i<n;i++){ let t=0,q;
    do{ q=gen(); t++; }while(used.has(q.text+q.work) && t<50);
    if(!used.has(q.text+q.work)){ used.add(q.text+q.work); out.push(q); }
  }};
  // Ø³Ù‡Ù„ (12)
  add(q_add_easy, 6);
  add(q_sub_easy, 6);
  // Ù…ØªÙˆØ³Ø· (12)
  add(q_add_bigger, 5);
  add(q_sub_hard , 5);
  add(q_word_add , 2);
  // ØµØ¹Ø¨ (6)
  add(q_fill_add , 3);
  add(q_fill_sub , 2);
  add(q_word_sub , 1);

  // Ù„Ùˆ Ù†Ù‚Øµ Ù†ÙƒÙ…Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù…ÙˆÙ„Ø¯Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©
  const gens=[q_add_easy,q_sub_easy,q_add_bigger,q_sub_hard,q_fill_add,q_fill_sub,q_word_add,q_word_sub];
  let guard=1000;
  while(out.length<TOTAL_Q && guard--){
    const q = gens[rnd(0,gens.length-1)]();
    if(!used.has(q.text+q.work)){ used.add(q.text+q.work); out.push(q); }
  }
  return out.slice(0,TOTAL_Q);
}

/* ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© */
let QUESTIONS = [];
let idx = 0, score = 0, timeLeft = TIME_LIMIT, timer = null, running=false;

function render(q){
  counterEl.textContent = `${idx+1} / ${TOTAL_Q}`;
  qEl.textContent       = q.text;
  workEl.innerHTML      = q.work || '';
  hintEl.textContent    = q.hint || '';
  choicesEl.innerHTML   = '';
  q.options.forEach(opt=>{
    const b = document.createElement('button');
    b.className = 'choice';
    // ØµÙŠØºØ© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª: ÙƒØ³ÙˆØ± "n/d" Ø£Ùˆ Ø£Ø¹Ø¯Ø§Ø¯ (Ù„Ø¨Ø³Ø· Ù…ÙÙ‚ÙˆØ¯)
    if(opt.includes('/')){
      const [n,d]=opt.split('/').map(Number);
      b.innerHTML = fracHTML(n,d);
      b.dataset.val = opt;
    }else{
      b.textContent = opt;
      b.dataset.val = opt;
    }
    b.onclick = ()=> choose(b.dataset.val, q.answer, b);
    choicesEl.appendChild(b);
  });
}

function choose(sel, ans, btn){
  if(String(sel)===String(ans)){
    btn.classList.add('correct');
    score++; scoreEl.textContent = score;
    setTimeout(()=>{
      idx++;
      if(idx>=TOTAL_Q){ win(); }
      else render(QUESTIONS[idx]);
    },140);
  } else {
    btn.classList.add('wrong');
    setTimeout(()=>{ window.location.href='index.html'; },140);
  }
}

function start(){
  if(running) return;
  running = true; doneEl.hidden=true;
  QUESTIONS = buildQuestions();
  idx=0; score=0; scoreEl.textContent=score;
  timeLeft = TIME_LIMIT; timeEl.textContent=timeLeft;
  render(QUESTIONS[idx]);
  startBtn.disabled = true; startBtn.textContent = 'Ø¬Ø§Ø±ÙŠâ€¦';
  clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--; timeEl.textContent=timeLeft;
    if(timeLeft<=0){
      clearInterval(timer);
      window.location.href = 'index.html';
    }
  },1000);
}

function win(){
  clearInterval(timer);
  qEl.textContent='Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± âœ…';
  workEl.innerHTML=''; hintEl.textContent='';
  choicesEl.innerHTML='';
  doneEl.hidden=false; startBtn.disabled=false; startBtn.textContent='Ø¥Ø¹Ø§Ø¯Ø©';
  running=false;
}

document.getElementById('startBtn').addEventListener('click', start);
</script>
</body>
</html>
