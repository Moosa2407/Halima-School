<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø¨Ø§Ù„Ø®Ø·ÙˆØ· â€” 30 Ø³Ø¤Ø§Ù„ / 1280 Ø«Ø§Ù†ÙŠØ©</title>
  <style>
    :root{
      --bg:#f8f6fb; --ink:#111827; --muted:#6b7280; --border:#e5e7eb;
      --panel:#fff; --panel2:#faf5ff; --accent:#805ad5; --ok:#16a34a; --bad:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:"Tahoma", Arial, sans-serif}
    .wrap{max-width:1100px;margin:auto;padding:18px}
    h1{margin:8px 0 4px;text-align:center}
    .subtitle{color:var(--muted);text-align:center;margin-bottom:12px}
    .status{display:flex;justify-content:space-between;align-items:center;gap:10px;background:var(--panel2);border:1px solid var(--border);padding:10px 14px;border-radius:12px}
    .chip{font-weight:700;padding:8px 12px;border-radius:10px;background:#e0e7ff}
    .chip.time{background:#fde0e0}
    .task{margin-top:16px;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    .task h2{margin:0 0 8px;font-size:20px}
    .grid-area{display:grid;grid-template-columns: 1fr 1fr;gap:16px}
    .table{border:1px solid var(--border);border-radius:10px;overflow:hidden}
    .table header{background:#f3f4f6;padding:8px 10px;font-weight:700}
    table{width:100%;border-collapse:collapse}
    th,td{border-top:1px solid var(--border);padding:8px 10px;text-align:center}
    .canvas{border:1px dashed #cbd5e1;border-radius:12px;padding:10px;background:#fff}
    .help{color:var(--muted);font-size:14px;margin:4px 0 8px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:8px}
    button{padding:10px 16px;border-radius:10px;border:1px solid #cbd5e1;background:#e5e7ff;cursor:pointer}
    button:hover{filter:brightness(0.98)}
    .note{margin-top:6px;color:var(--muted)}
    svg{width:100%;height:360px;display:block;background:#ffffff;border:1px solid #e5e7eb;border-radius:10px}
    .axis text{font-size:12px;fill:#374151}
    .grid line{stroke:#e5e7eb}
    .line{fill:none;stroke:#60a5fa;stroke-width:3}
    .pt{fill:#2563eb;cursor:pointer}
    .qbox{margin-top:10px;background:#faf5ff;border:1px solid #ead6ff;border-radius:10px;padding:10px}
    .answers{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
    .answers button{background:#fff;border:1px solid #cbd5e1}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø¨Ø§Ù„Ø®Ø·ÙˆØ·</h1>
    <p class="subtitle">Ù„Ø¯ÙŠÙƒ <b>1280 Ø«Ø§Ù†ÙŠØ©</b> Ù„Ø¥ÙƒÙ…Ø§Ù„ <b>30 Ø³Ø¤Ø§Ù„Ù‹Ø§</b>. Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª Ø£Ùˆ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø³ØªØ¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>

    <div class="status">
      <div class="chip">Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="qNo">1 / 30</span></div>
      <div class="chip">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span> / 30</div>
      <div class="chip time">â° Ø§Ù„ÙˆÙ‚Øª: <span id="time">1280</span> Ø«Ø§Ù†ÙŠØ©</div>
    </div>

    <section id="task" class="task">
      <h2 id="taskTitle">â€”</h2>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ù…Ø®Ø·Ø· Ø¬Ø§Ù‡Ø² -->
      <div id="readPane" style="display:none">
        <svg id="staticChart" viewBox="0 0 600 360"></svg>
        <div class="qbox">
          <div id="readQuestion">â€”</div>
          <div class="answers" id="readAnswers"></div>
        </div>
      </div>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù… Ù…Ù† Ø¬Ø¯ÙˆÙ„ -->
      <div id="drawPane" style="display:none">
        <div class="grid-area">
          <div class="table">
            <header id="tableTitle">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</header>
            <table id="dataTable"><thead><tr><th id="xHead">Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙÙ‚ÙŠ</th><th id="yHead">Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody></tbody></table>
          </div>
          <div>
            <div class="canvas">
              <div class="help" id="scaleHelp">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ© Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·. Ø§Ù†Ù‚Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØºÙŠÙŠØ± Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‚Ø·Ø©.</div>
              <svg id="drawChart" viewBox="0 0 600 360"></svg>
            </div>
            <div class="controls">
              <button id="checkBtn">ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø§Ù„Ø±Ø³Ù…</button>
              <span class="note">Ø¶Ø¹ Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ Ø¹Ù†ØµØ± Ø«Ù… ÙˆØµÙ„Ù‡ Ø§Ù„Ù†Ø¸Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</span>
            </div>
          </div>
        </div>

        <div class="qbox" id="followupBox" style="display:none">
          <div id="followQuestion">â€”</div>
          <div class="answers" id="followAnswers"></div>
        </div>
      </div>
    </section>
  </div>

<script>
/* ========= Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø±ÙˆØ³ ========= */
// (1) Ù…Ø®Ø·Ø· Ø¬Ø§Ù‡Ø² â€” ÙˆØ²Ù† Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ (Ø²ÙŠØ§Ø¯Ø© Ø´Ø¨Ù‡ Ø«Ø§Ø¨ØªØ©)
const READ = {
  title: 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„ØªØ§Ù„ÙŠ Ø«Ù… Ø£Ø¬Ø¨:',
  xLabel: 'Ø§Ù„Ø´Ù‡Ø±', yLabel: 'Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)',
  X: ['Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦'],
  Y: [3.2, 3.8, 4.4, 5.0, 5.6, 6.2]
};

// (2) Ø§Ø±Ø³Ù… â€” Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø±
const DRAW1 = {
  title: 'Ù…Ø«Ù‘ÙÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø± Ø¨Ø§Ù„Ø®Ø·ÙˆØ· Ø«Ù… Ø£Ø¬Ø¨:',
  tableTitle: 'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø± Ø¨Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
  xHead: 'Ø§Ù„Ø´Ù‡Ø±', yHead: 'Ø§Ù„Ø³Ø§Ø¹Ø©',
  xLabel: 'Ø§Ù„Ø´Ù‡Ø±', yLabel: 'Ø§Ù„Ø³Ø§Ø¹Ø©',
  hint: 'Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø±Ø£Ø³ÙŠ = 1 Ø³Ø§Ø¹Ø©',
  X: ['Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³'],
  Y: [13, 12, 10, 11]
};

// (3) Ø§Ø±Ø³Ù… â€” Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†
const DRAW2 = {
  title: 'Ù…Ø«Ù‘ÙÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù† Ø¨Ø§Ù„Ø®Ø·ÙˆØ· Ø«Ù… Ø£Ø¬Ø¨:',
  tableTitle: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù† (Ø¨Ø§Ù„Ø¢Ù„Ø§Ù)',
  xHead: 'Ø§Ù„Ø³Ù†Ø©', yHead: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù† (Ø£Ù„Ù)',
  xLabel: 'Ø§Ù„Ø³Ù†Ø©', yLabel: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù† (Ø£Ù„Ù)',
  hint: 'ÙƒÙ„ Ø®Ø· Ø£ÙÙ‚ÙŠ â‰ˆ 50 Ø£Ù„Ù',
  X: ['2001','2002','2003','2004'],
  Y: [180, 210, 230, 260]
};

/* ========= Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© ========= */
const qNoEl   = document.getElementById('qNo');
const scoreEl = document.getElementById('score');
const timeEl  = document.getElementById('time');
const titleEl = document.getElementById('taskTitle');

const readPane = document.getElementById('readPane');
const staticChart = document.getElementById('staticChart');
const readQ = document.getElementById('readQuestion');
const readA = document.getElementById('readAnswers');

const drawPane = document.getElementById('drawPane');
const tableTitleEl = document.getElementById('tableTitle');
const xHeadEl = document.getElementById('xHead');
const yHeadEl = document.getElementById('yHead');
const tbodyEl = document.querySelector('#dataTable tbody');
const scaleHelpEl = document.getElementById('scaleHelp');
const drawChart = document.getElementById('drawChart');
const checkBtn  = document.getElementById('checkBtn');
const followBox = document.getElementById('followupBox');
const followQ   = document.getElementById('followQuestion');
const followA   = document.getElementById('followAnswers');

let TOTAL = 30;           // Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
let idx = 0;              // Ù…Ø¤Ø´Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯
let score = 0;
let timeLeft = 1280;
let timer = null;

function shuffle(a){ return a.sort(()=>Math.random()-0.5); }
function choice3(correct, pool){           // ÙŠØ¨Ù†ÙŠ Ø«Ù„Ø§Ø« Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
  const set = new Set([correct]);
  shuffle(pool).forEach(v=>set.add(v));
  return shuffle(Array.from(set).slice(0,3).map(x=>String(x)));
}
function fmt(v){ return (Math.round(v*10)/10).toString(); }

/* ========= Ø±Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ø®Ø· Ø¨Ù€ SVG ========= */
function svgGrid(svg, X, Y, labels, showLine=true, editable=false, onPick=null){
  svg.innerHTML='';
  const W=600,H=360,pL=60,pR=20,pT=20,pB=40;
  const x0=pL, y0=H-pB, x1=W-pR, y1=pT;
  const gG=svge('g'), gA=svge('g'), gL=svge('g');
  svg.append(gG,gA,gL);

  const maxY=Math.max(...Y, 1);
  const steps=10;
  for(let i=0;i<=steps;i++){
    const yy= y0 - i*(y0-y1)/steps;
    gG.appendChild(svge('line',{x1:x0,y1:yy,x2:x1,y2:yy,stroke:'#e5e7eb'}));
    gA.appendChild(svge('text',{x:x0-8,y:yy+4,'text-anchor':'end'}, Math.round(i*maxY/steps)));
  }
  const n=X.length;
  for(let i=0;i<n;i++){
    const xx= x0 + i*(x1-x0)/(n-1);
    gG.appendChild(svge('line',{x1:xx,y1:y0,x2:xx,y2:y1,stroke:'#f3f4f6'}));
    gA.appendChild(svge('text',{x:xx,y:y0+20,'text-anchor':'middle'}, X[i]));
  }
  gA.appendChild(svge('text',{x:(x0+x1)/2,y:H-6,'text-anchor':'middle'}, labels.x));
  gA.appendChild(svge('text',{x:16,y:(y0+y1)/2,transform:`rotate(-90 16 ${(y0+y1)/2})`,'text-anchor':'middle'}, labels.y));

  // Ø®Ø· Ø¬Ø§Ù‡Ø²
  if(showLine && Y.length===n){
    const pts = Y.map((v,i)=>[x0 + i*(x1-x0)/(n-1), y0 - (v/maxY)*(y0-y1)]);
    gL.appendChild(svge('path',{d:pts.map((p,i)=>(i?'L':'M')+p[0]+','+p[1]).join(' '),class:'line'}));
    pts.forEach(p=>gL.appendChild(svge('circle',{cx:p[0],cy:p[1],r:5,fill:'#2563eb'})));
  }

  // Ù†Ù‚Ø§Ø· ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ø±Ø³Ù…
  if(editable){
    const picked = new Array(n);
    for(let i=0;i<n;i++){
      const xx= x0 + i*(x1-x0)/(n-1);
      const m = svge('circle',{cx:xx,cy:y0,r:6,fill:'#94a3b8',class:'pt'});
      m.addEventListener('click', e=>{
        const box=svg.getBoundingClientRect();
        const cy=Math.max(y1,Math.min(y0, e.clientY-box.top));
        m.setAttribute('cy',cy);
        const frac=(y0-cy)/(y0-y1);
        picked[i]=Math.round(frac*maxY);
        redraw();
        if(onPick) onPick(picked);
      });
      gL.appendChild(m);
    }
    function redraw(){
      const old=svg.querySelector('path.user'); if(old) old.remove();
      if(picked.every(v=>Number.isFinite(v))){
        const pts = picked.map((v,i)=>[x0 + i*(x1-x0)/(n-1), y0 - (v/maxY)*(y0-y1)]);
        gL.appendChild(svge('path',{d:pts.map((p,i)=>(i?'L':'M')+p[0]+','+p[1]).join(' '),class:'user',stroke:'#10b981','stroke-width':'3',fill:'none'}));
      }
    }
    return picked; // Ù†Ø¹ÙŠØ¯ Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„ÙŠØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø§Ù„Ù…ØªØ­Ù‚Ù‚
  }
  return null;
}
function svge(tag,attrs={},text){
  const e=document.createElementNS('http://www.w3.org/2000/svg',tag);
  for(const k in attrs) e.setAttribute(k,attrs[k]);
  if(text!==undefined) e.textContent=text;
  return e;
}

/* ========= Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (30) =========
   Ù†Ø¨Ù†ÙŠ 10 Ø£Ø³Ø¦Ù„Ø© Ù…Ù† ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù‚Ø±Ø§Ø¡Ø©/Ø±Ø³Ù…1/Ø±Ø³Ù…2) = 30
===================================== */
const BANK = [];

// 10 Ø£Ø³Ø¦Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ø§Ù‡Ø²
(function(){
  const X=READ.X, Y=READ.Y;
  const n=X.length, max=Math.max(...Y), min=Math.min(...Y);
  // Ø§Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ø§Ù‡Ø² Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¶
  BANK.push({type:'read-init', title:READ.title, x:X, y:Y, labels:{x:READ.xLabel,y:READ.yLabel}});
  // 1
  BANK.push({type:'read-q', q:'Ù…Ø§ Ø§Ù„ÙˆØ­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø£Ø³ÙŠØŸ', correct:'ÙƒØ¬Ù…', options:['ÙƒØ¬Ù…','Ø³Ù…','Ø³Ø§Ø¹Ø©']});
  // 2
  BANK.push({type:'read-q', q:`ÙƒÙ… ÙƒØ§Ù† Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ø´Ù‡Ø± ${X[3]}ØŸ`, correct:fmt(Y[3]), options:choice3(fmt(Y[3]),[fmt(Y[2]),fmt(Y[4])]).map(String)});
  // 3
  BANK.push({type:'read-q', q:'ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø± ÙƒØ§Ù† Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø£ØµØºØ±ØŸ', correct:`Ø§Ù„Ø´Ù‡Ø± ${X[Y.indexOf(min)]}`, options:shuffle([`Ø§Ù„Ø´Ù‡Ø± ${X[Y.indexOf(min)]}`,`Ø§Ù„Ø´Ù‡Ø± ${X[0]}`,`Ø§Ù„Ø´Ù‡Ø± ${X[n-1]}`])});
  // 4
  BANK.push({type:'read-q', q:'ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø± ÙƒØ§Ù† Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø£ÙƒØ¨Ø±ØŸ', correct:`Ø§Ù„Ø´Ù‡Ø± ${X[Y.indexOf(max)]}`, options:shuffle([`Ø§Ù„Ø´Ù‡Ø± ${X[Y.indexOf(max)]}`,`Ø§Ù„Ø´Ù‡Ø± ${X[2]}`,`Ø§Ù„Ø´Ù‡Ø± ${X[3]}`])});
  // 5 ÙØ±Ù‚ Ø¨ÙŠÙ† Ø´Ù‡Ø±ÙŠÙ†
  const d1=fmt(Y[5]-Y[0]);
  BANK.push({type:'read-q', q:`ÙƒÙ… Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù‡Ø± ${X[0]} Ø¥Ù„Ù‰ ${X[5]}ØŸ`, correct:d1+' ÙƒØ¬Ù…', options:shuffle([d1+' ÙƒØ¬Ù…','0.6 ÙƒØ¬Ù…','2.0 ÙƒØ¬Ù…'])});
  // 6 Ù…Ø¹Ø¯Ù„ Ø´Ù‡Ø±ÙŠ
  const avg=fmt((Y[n-1]-Y[0])/(n-1));
  BANK.push({type:'read-q', q:'Ù…Ø§ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØŸ', correct:avg+' ÙƒØ¬Ù…', options:shuffle([avg+' ÙƒØ¬Ù…','0.3 ÙƒØ¬Ù…','1.2 ÙƒØ¬Ù…'])});
  // 7 Ø£ÙƒØ¨Ø± Ù‚ÙØ²Ø© Ø¨ÙŠÙ† Ø´Ù‡Ø±ÙŠÙ† Ù…ØªØªØ§Ù„ÙŠÙ† (ÙƒÙ„Ù‡Ø§ 0.6 Ù‡Ù†Ø§)
  BANK.push({type:'read-q', q:'Ø£ÙƒØ¨Ø± Ø²ÙŠØ§Ø¯Ø© Ø¨ÙŠÙ† Ø´Ù‡Ø±ÙŠÙ† Ù…ØªØªØ§Ù„ÙŠÙ† ØªØ³Ø§ÙˆÙŠ:', correct:'0.6 ÙƒØ¬Ù…', options:shuffle(['0.6 ÙƒØ¬Ù…','0.8 ÙƒØ¬Ù…','0.3 ÙƒØ¬Ù…'])});
  // 8 ÙˆØµÙ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
  BANK.push({type:'read-q', q:'ÙˆØµÙ Ø§Ù„ØªØºÙŠÙ‘Ø± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ÙˆØ²Ù†:', correct:'ÙŠØ²Ø¯Ø§Ø¯ Ø¨Ø«Ø¨Ø§Øª ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§', options:shuffle(['ÙŠØ²Ø¯Ø§Ø¯ Ø¨Ø«Ø¨Ø§Øª ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§','ÙŠÙ†Ù‚Øµ','Ù„Ø§ ÙŠØªØºÙŠØ±'])});
  // 9 Ù‡Ù„ Ø§Ù„ÙˆØ²Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø´Ù‡Ø± Ù¤ Ø£ÙƒØ¨Ø± Ù…Ù† Ù¥ØŸ (Ø³Ø¤Ø§Ù„ Ù…ÙÙ‡ÙˆÙ…ÙŠ Ø¹ÙƒØ³ÙŠ)
  BANK.push({type:'read-q', q:'Ù‡Ù„ Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ù¤ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ù¥ØŸ', correct:'Ù„Ø§', options:shuffle(['Ù„Ø§','Ù†Ø¹Ù…','Ù…ØªØ³Ø§ÙˆÙŠØ§Ù†'])});
  // 10 Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù† ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ (ØªØ¬Ù…ÙŠØ¹ÙŠ Ø¨Ø³ÙŠØ·)
  const sum = Y.reduce((a,b)=>a+b,0);
  BANK.push({type:'read-q', q:'Ø£ÙŠ Ø§Ù„Ù‚ÙŠÙ… Ø£Ù‚Ø±Ø¨ Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ù„ÙƒÙ„ Ø§Ù„Ø£Ø´Ù‡Ø±ØŸ', correct:Math.round(sum)+' ÙƒØ¬Ù…', options:choice3(Math.round(sum)+' ÙƒØ¬Ù…',[Math.round(sum-2)+' ÙƒØ¬Ù…',Math.round(sum+2)+' ÙƒØ¬Ù…'])});
})();

// 10 Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯ Ø±Ø³Ù… Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø±
(function(){
  BANK.push({type:'draw-init', data:DRAW1});
  const X=DRAW1.X, Y=DRAW1.Y, n=X.length;
  BANK.push({type:'follow', q:'Ù…Ø§ Ø§Ù„ØªØ¯Ø±Ù‘Ø¬ Ù„ÙƒÙ„ Ù…Ø­ÙˆØ±ØŸ', correct:'Ø§Ù„Ø£ÙÙ‚ÙŠ Ø£Ø´Ù‡Ø± / Ø§Ù„Ø±Ø£Ø³ÙŠ Ø³Ø§Ø¹Ø§Øª', options:shuffle(['Ø§Ù„Ø£ÙÙ‚ÙŠ Ø£Ø´Ù‡Ø± / Ø§Ù„Ø±Ø£Ø³ÙŠ Ø³Ø§Ø¹Ø§Øª','Ø§Ù„Ø£ÙÙ‚ÙŠ Ø³Ø§Ø¹Ø§Øª / Ø§Ù„Ø±Ø£Ø³ÙŠ Ø£Ø´Ù‡Ø±','ÙƒÙ„Ø§Ù‡Ù…Ø§ Ø³Ø§Ø¹Ø§Øª'])});
  BANK.push({type:'follow', q:`ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙÙŠ ${X[0]}ØŸ`, correct:String(Y[0]), options:choice3(Y[0],[Y[1],Y[2],Y[3]])});
  BANK.push({type:'follow', q:`ÙƒÙ… Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ${X[0]} Ùˆ ${X[2]}ØŸ`, correct:String(Math.abs(Y[0]-Y[2])), options:choice3(Math.abs(Y[0]-Y[2]),[1,2,3,4])});
  BANK.push({type:'follow', q:'Ù…Ø§ Ø§Ù„Ø´Ù‡Ø± Ø°Ùˆ Ø£Ù‚Ù„ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§ØªØŸ', correct:X[Y.indexOf(Math.min(...Y))], options:shuffle([X[2],X[1],X[3]])});
  BANK.push({type:'follow', q:'Ù…Ø§ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù…Ù† Ù…Ø§ÙŠÙˆ Ø¥Ù„Ù‰ ÙŠÙˆÙ„ÙŠÙˆØŸ', correct:'ÙŠÙ†Ù‚Øµ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§', options:shuffle(['ÙŠÙ†Ù‚Øµ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§','ÙŠØ²Ø¯Ø§Ø¯','Ø«Ø§Ø¨Øª'])});
  BANK.push({type:'follow', q:'Ù…Ø§ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙÙŠ ÙŠÙˆÙ†ÙŠÙˆ ÙˆÙŠÙˆÙ„ÙŠÙˆØŸ', correct:String(Y[1]+Y[2]), options:choice3(Y[1]+Y[2],[Y[1]+Y[3],Y[0]+Y[2],Y[0]+Y[1]])});
  BANK.push({type:'follow', q:'ÙƒÙ… Ø§Ù„Ù…ØªÙˆØ³Ù‘Ø· (ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§) Ù„Ø³Ø§Ø¹Ø§Øª Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø´Ù‡Ø±ØŸ', correct:String(Math.round(Y.reduce((a,b)=>a+b,0)/n)), options:choice3(Math.round(Y.reduce((a,b)=>a+b,0)/n),[10,11,12,13])});
  BANK.push({type:'follow', q:`ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø± ÙŠØ¹ÙˆØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†Ø®ÙØ§Ø¶ØŸ`, correct:'Ø£ØºØ³Ø·Ø³', options:shuffle(['Ø£ØºØ³Ø·Ø³','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ'])});
  BANK.push({type:'follow', q:`Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø± Ø§Ù„Ù†Ù‚Øµ Ø¨Ù…Ù‚Ø¯Ø§Ø± 1 Ø³Ø§Ø¹Ø© Ø¨Ø¹Ø¯ ÙŠÙˆÙ„ÙŠÙˆØŒ ÙƒÙ… Ù†ØªÙˆÙ‚Ø¹ ÙÙŠ Ø£ØºØ³Ø·Ø³ØŸ`, correct:String(9), options:choice3(9,[10,8,11])});
})();

// 10 Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯ Ø±Ø³Ù… Ø§Ù„Ø³ÙƒØ§Ù†
(function(){
  BANK.push({type:'draw-init', data:DRAW2});
  const X=DRAW2.X, Y=DRAW2.Y, n=X.length;
  BANK.push({type:'follow', q:'Ø£Ø¹Ù„Ù‰ Ø³Ù†Ø© ÙÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†:', correct:X[Y.indexOf(Math.max(...Y))], options:shuffle(X.slice())});
  BANK.push({type:'follow', q:`ÙƒÙ… ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù† Ø¹Ø§Ù… ${X[0]} (Ø¨Ø§Ù„Ø£Ù„Ù)?`, correct:String(Y[0]), options:choice3(Y[0],[Y[1],Y[2],Y[3]])});
  BANK.push({type:'follow', q:`Ù…Ø§ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ù…Ù† ${X[0]} Ø¥Ù„Ù‰ ${X[3]}ØŸ`, correct:String(Y[3]-Y[0]), options:choice3(Y[3]-Y[0],[20,50,40,60])});
  BANK.push({type:'follow', q:'Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ø§Ù… Ù…Ù† 2001 Ø¥Ù„Ù‰ 2004:', correct:'Ø²ÙŠØ§Ø¯Ø©', options:shuffle(['Ø²ÙŠØ§Ø¯Ø©','Ø§Ù†Ø®ÙØ§Ø¶','Ø«Ø¨Ø§Øª'])});
  BANK.push({type:'follow', q:`ÙƒÙ… Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ${X[1]} Ùˆ ${X[2]}ØŸ`, correct:String(Math.abs(Y[1]-Y[2])), options:choice3(Math.abs(Y[1]-Y[2]),[10,30,40])});
  BANK.push({type:'follow', q:'Ù…Ø§ Ù…ØªÙˆØ³Ø· Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù† (ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§) Ø¹Ø¨Ø± Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹ØŸ', correct:String(Math.round(Y.reduce((a,b)=>a+b,0)/n)), options:choice3(Math.round(Y.reduce((a,b)=>a+b,0)/n),[200,220,230,240])});
  BANK.push({type:'follow', q:`Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±Øª Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø¨Ù†ÙØ³ ÙˆØªÙŠØ±Ø© 2003â†’2004ØŒ ØªÙ‚Ø¯ÙŠØ± 2005ØŸ`, correct:String(Y[3]+(Y[3]-Y[2])), options:choice3(Y[3]+(Y[3]-Y[2]),[Y[3]+10,Y[3]+20,Y[3]+40])});
  BANK.push({type:'follow', q:`Ø£ÙŠ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø£Ù‚Ù„ Ù…Ù† 220 Ø£Ù„ÙØŸ`, correct:'2001 ÙÙ‚Ø·', options:shuffle(['2001 ÙÙ‚Ø·','2001 Ùˆ2002','2002 ÙÙ‚Ø·'])});
  BANK.push({type:'follow', q:`Ø£ÙƒØ¨Ø± Ù‚ÙØ²Ø© ÙˆÙ‚Ø¹Øª Ø¨ÙŠÙ†:`, correct:'2001 â†’ 2002', options:shuffle(['2001 â†’ 2002','2002 â†’ 2003','2003 â†’ 2004'])});
})();

// ØªØ£ÙƒØ¯ Ø£Ù† BANK ÙŠØ­ÙˆÙŠ Ø¨Ø§Ù„Ø¶Ø¨Ø· 30 Ø¹Ù†ØµØ± Ø³Ø¤Ø§Ù„ ÙØ¹Ù‘Ø§Ù„ (Ø¹Ø¯Ø§ init)
const QUESTION_STREAM = [];
BANK.forEach(item=>{
  if(item.type.endsWith('init')) QUESTION_STREAM.push(item);
  else QUESTION_STREAM.push(item);
});
// Ø³Ù†Ø¹ØªÙ…Ø¯ ØªØ±ØªÙŠØ¨Ù‡Ø§ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø³Ù‡Ù„ â†’ Ø£ØµØ¹Ø¨)

let mode = null;           // read | draw
let picked = null;         // Ù…ØµÙÙˆÙØ© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø±Ø³ÙˆÙ…Ø©
let stepInBlock = 0;       // Ø¹Ø¯Ø§Ø¯ Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©/Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©

/* ========= Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¹Ø±Ø¶ ========= */
function startTimer(){
  clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--; timeEl.textContent=timeLeft;
    if(timeLeft<=0) fail('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!');
  },1000);
}

function next(){
  if(idx >= QUESTION_STREAM.length){ win(); return; }
  const item = QUESTION_STREAM[idx];

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¸Ø§Ù‡Ø± (Ù†ØªØ¬Ø§Ù‡Ù„ Ø¹Ù†Ø§ØµØ± init ÙÙŠ Ø§Ù„Ø¹Ø¯)
  const visibleIndex = 1 + QUESTION_STREAM.slice(0,idx).filter(x=>!x.type.endsWith('init')).length;
  const visibleTotal = QUESTION_STREAM.filter(x=>!x.type.endsWith('init')).length;
  qNoEl.textContent = `${visibleIndex} / ${visibleTotal}`;

  if(item.type==='read-init'){
    mode='read';
    titleEl.textContent = READ.title;
    readPane.style.display='block';
    drawPane.style.display='none';
    svgGrid(staticChart, item.x, item.y, item.labels, true, false);
    stepInBlock=0;
    idx++; // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    renderReadQuestion();
    return;
  }
  if(item.type==='draw-init'){
    mode='draw';
    readPane.style.display='none';
    drawPane.style.display='block';
    titleEl.textContent = item.data.title;
    // Ø¬Ù‡Ù‘Ø² Ø§Ù„Ø¬Ø¯ÙˆÙ„
    tableTitleEl.textContent = item.data.tableTitle;
    xHeadEl.textContent = item.data.xHead;
    yHeadEl.textContent = item.data.yHead;
    tbodyEl.innerHTML='';
    item.data.X.forEach((x,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${x}</td><td>${item.data.Y[i]}</td>`;
      tbodyEl.appendChild(tr);
    });
    scaleHelpEl.textContent = item.data.hint;
    // Ø§Ø±Ø³Ù… Ø´Ø¨ÙƒØ© ØªÙØ§Ø¹Ù„ÙŠØ©
    picked = svgGrid(drawChart, item.data.X, [], {x:item.data.xLabel,y:item.data.yLabel}, false, true, p=>{ picked=p; });
    followBox.style.display='none';
    checkBtn.onclick = ()=> verifyDrawing(item.data);
    idx++; // Ø¨Ø¹Ø¯ initØŒ Ù†Ù†ØªÙ‚Ù„ Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚
    return;
  }
}

/* ======== Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© (Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ø§Ù‡Ø²) ======== */
function renderReadQuestion(){
  // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø¹Ù†ØµØ± read-q Ù…Ù† Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
  const qItem = QUESTION_STREAM[idx];
  if(!qItem || qItem.type!=='read-q'){ next(); return; }
  readQ.textContent = qItem.q;
  readA.innerHTML='';
  shuffle(qItem.options.slice()).forEach(opt=>{
    const b=document.createElement('button');
    b.textContent=opt;
    b.onclick=()=>{
      if(opt===qItem.correct){ score++; scoreEl.textContent=score; idx++; renderReadQuestion(); }
      else fail('Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
    };
    readA.appendChild(b);
  });
}

/* ======== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø³Ù… ======== */
function verifyDrawing(ds){
  if(!picked || picked.some(v=>!Number.isFinite(v))){
    alert('Ø¶ÙØ¹ Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ Ø¹Ù†ØµØ± Ø£ÙˆÙ„Ù‹Ø§.');
    return;
  }
  // ØªØ·Ø§Ø¨Ù‚ ØªØ§Ù… Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ… (Ø¨Ø¯ÙˆÙ† Ø³Ù…Ø§Ø­ÙŠØ© Ù‡Ù†Ø§)
  for(let i=0;i<ds.Y.length;i++){
    if(picked[i] !== ds.Y[i]){ fail('Ù‡Ù†Ø§Ùƒ Ù†Ù‚Ø·Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± ÙÙŠ ØºÙŠØ± Ù…ÙˆØ¶Ø¹Ù‡Ø§.'); return; }
  }
  // Ù†Ø¬Ø­ Ø§Ù„Ø±Ø³Ù… â†’ Ø§Ù†ØªÙ‚Ù„ Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© (follow)
  followBox.style.display='block';
  presentFollow();
}

function presentFollow(){
  // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø¹Ù†ØµØ± follow Ù…Ù† Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
  if(idx >= QUESTION_STREAM.length){ win(); return; }
  const item = QUESTION_STREAM[idx];
  if(!item || item.type!=='follow'){ next(); return; }
  followQ.textContent = item.q;
  followA.innerHTML='';
  shuffle(item.options.slice()).forEach(opt=>{
    const b=document.createElement('button');
    b.textContent=opt;
    b.onclick=()=>{
      if(opt===item.correct){ score++; scoreEl.textContent=score; idx++; presentFollow(); }
      else fail('Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
    };
    followA.appendChild(b);
  });
}

/* ======== Ù†Ù‡Ø§ÙŠØ©/ÙØ´Ù„ ======== */
function win(){
  clearInterval(timer);
  alert('Ø£Ø­Ø³Ù†Øª! Ø£ÙƒÙ…Ù„Øª 30 Ø³Ø¤Ø§Ù„Ù‹Ø§ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‘');
  window.location.href='index.html';
}
function fail(msg){
  clearInterval(timer);
  alert(msg + ' Ø³ØªØ¹ÙˆØ¯ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.');
  window.location.href='index.html';
}

/* ======== ØªØ´ØºÙŠÙ„ ======== */
startTimer();
next();
</script>
</body>
</html>
